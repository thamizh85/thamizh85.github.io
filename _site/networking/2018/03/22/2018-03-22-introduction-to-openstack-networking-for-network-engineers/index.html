
<!doctype html>














<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="google9355da1d9e940142.html" />













  
  
  <link href="/assets/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/assets/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/assets/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="openstack,software defined networking,networking," />





  <link rel="alternate" href="/atom.xml" title="Ephemeral Electrons" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.ico?v=5.1.1" />
















<meta name="description" content="Introduction This post is a gentle introduction to networking with Openstack using the Neutron module. Being an introduction, we will not focus on setting up OpenStack from scratch. Instead we will familiarize ourselves with core concepts of Neutron and common administrative tasks. We will use the latest release of Openstack, Queens. For ease of setup, we will make use of pre-packaged Devstack environment. Devstack is a set of scripts from official OpenStack community that allows us to quickly build an Openstack instance with latest versions of all modules. It is very useful for testing and training purposes. Neutron Concepts Let us go through the important terms first: Network - A Network is a logical container of entities. To think of it in physical networking terms, it can represent a site, a DC, a campus- or anything else termed as a single network. In AWS terms, a network is similar to a VPC. Note that the definition of a Network is not entirely arbitrary as we may encounter some design choices when deciding CIDR, load balancers, routers, external gateway etc., Subnet - Subnet is similar to a vlan in traditional networking. All hosts in the same Subnet can talk to each other and share the same address space. For beginners, it is possible to confuse a Subnet with Network since both terms are used interchangeably in traditional networking. But keep in mind that one network can contain many subnets. The concept of a Subnet is similar both in OpenStack and AWS. Port - A port is a virtual NIC card which is used by resources to access network. A port is tied to a subnet and assigned with a Security group (introduced below). In AWS terms, it is similar to ENI (Elastic Network Interface) Security Group - Security groups are like port ACL in traditional networking, except that the filtering happens at the hypervisor level. Multiple ports can share the same security group. By default, entities assigned to the same Security Group can talk to each other. It is also similar in scope and function to the Security Group in AWS. Floating IP - This is similar to elastic IP in AWS. These are not tied to any port and can be re-assigned to other ports dynamically. The closest feature in traditional networking would be a static NAT. In AWS terms, it is called Elastic IP. Objective We will create the below topology on Openstack. Hosts host-1 &amp;amp; host-2 will be on same subnet while host-3 will be on another subnet. We will enable reachability between all 3 hosts. Finally, we will also enable bi-directional connectivity to host-1 from internet. Preparing the environment Make home directory for our devstack installation and download the latest copy of DevStack there. I am using Ubuntu 16.04 for my environment. $ sudo mkdir -p /opt/stack &amp;amp;&amp;amp; cd /opt/stack $ sudo git clone https://git.openstack.org/openstack-dev/devstack Switch to devstack folder and create a user account using the pre-built script. The script grants passwordless root privilege to this account. Switch to the stack account to proceed with rest of the steps. $ cd devstack $ sudo bash tools/create-stack-user.sh Switch to stack user and create a config file. Provide your preferred password which will be used for rest of the setup. The local.conf should be present in the root directory of devstack (same location as stack.sh) $ sudo su stack $ vi local.conf [[local|localrc]] ADMIN_PASSWORD=password DATABASE_PASSWORD=$ADMIN_PASSWORD RABBIT_PASSWORD=$ADMIN_PASSWORD SERVICE_PASSWORD=$ADMIN_PASSWORD Run the setup script stack.sh and watch the magic happen. It takes a while since the script installs almost every component of Openstack. ./stack.sh DevStack also provides convenient script to tear down the environment and start from scratch. So once we are done with our testing, we can run unstack.sh to bring the environment back to a blank state. After the installation is complete, source the openrc file to import openstack commands in your searchpath. source openrc Building subnets Before we create new subnets, let us list the set of pre-built subnets that were setup as part of devstack deployment. stack@openstack-instance-2:~/devstack$ openstack network list -f yaml - ID: 1fe4e71c-d94e-400c-bcee-8067b621c827 Name: public Subnets: c0718110-7493-46bf-ba48-720762e47934, fab15575-ae4f-4528-bf0d-ac40d2000484 - ID: 2ebe2084-6dae-40dd-8704-7954944238d7 Name: private Subnets: 244ed014-8b9f-4e4d-ab12-9931ecec4238, 265de598-d881-4d58-a185-1a69be39b2fd The default output format is table. To simplify horizontal scrolling, I have selected yaml output using the -f switch. Create a new network called inside. stack@openstack-instance-2:~/devstack$ openstack network create inside +---------------------------+--------------------------------------+ | Field | Value | +---------------------------+--------------------------------------+ | admin_state_up | UP | | availability_zone_hints | | | availability_zones | | | created_at | 2018-04-01T09:14:41Z | | description | | | dns_domain | None | | id | a0fc23dd-f1a5-4e9b-9d58-ea63b30d076b | | ipv4_address_scope | None | | ipv6_address_scope | None | | is_default | False | | is_vlan_transparent | None | | mtu | 1450 | | name | inside | | port_security_enabled | True | | project_id | 9d390c83cc4e46c7a40167dee68075f0 | | provider:network_type | None | | provider:physical_network | None | | provider:segmentation_id | None | | qos_policy_id | None | | revision_number | 2 | | router:external | Internal | | segments | None | | shared | False | | status | ACTIVE | | subnets | | | tags | | | updated_at | 2018-04-01T09:14:41Z | +---------------------------+--------------------------------------+ Next we will create new subnets. Before that, let us list down the existing subnets for reference. stack@openstack-instance-2:~/devstack$ openstack subnet list -f yaml - ID: 244ed014-8b9f-4e4d-ab12-9931ecec4238 Name: private-subnet Network: 2ebe2084-6dae-40dd-8704-7954944238d7 Subnet: 10.0.0.0/26 - ID: 265de598-d881-4d58-a185-1a69be39b2fd Name: ipv6-private-subnet Network: 2ebe2084-6dae-40dd-8704-7954944238d7 Subnet: fd7b:34b0:9a57::/64 Create a new subnet within the network. We will call it net-01 and assign a subnet range of 10.1.1.0/24 stack@openstack-instance-2:~/devstack$ openstack subnet create net-01 --network inside --subnet-range 10.1.1.0/24 +-------------------+--------------------------------------+ | Field | Value | +-------------------+--------------------------------------+ | allocation_pools | 10.1.1.2-10.1.1.254 | | cidr | 10.1.1.0/24 | | created_at | 2018-04-01T09:20:13Z | | description | | | dns_nameservers | | | enable_dhcp | True | | gateway_ip | 10.1.1.1 | | host_routes | | | id | 0317aa4a-84d3-44df-8781-3f04d558a473 | | ip_version | 4 | | ipv6_address_mode | None | | ipv6_ra_mode | None | | name | net-01 | | network_id | a0fc23dd-f1a5-4e9b-9d58-ea63b30d076b | | project_id | 9d390c83cc4e46c7a40167dee68075f0 | | revision_number | 0 | | segment_id | None | | service_types | | | subnetpool_id | None | | tags | | | updated_at | 2018-04-01T09:20:13Z | +-------------------+--------------------------------------+ As mentioned earlier, the relation between subnet and network is many-to-one. So we can create another subnet net-02 within the same inside network. stack@openstack-instance-2:~/devstack$ openstack subnet create net-02 --network inside --subnet-range 10.1.2.0/24 +-------------------+--------------------------------------+ | Field | Value | +-------------------+--------------------------------------+ | allocation_pools | 10.1.2.2-10.1.2.254 | | cidr | 10.1.2.0/24 | | created_at | 2018-04-01T09:21:07Z | | description | | | dns_nameservers | | | enable_dhcp | True | | gateway_ip | 10.1.2.1 | | host_routes | | | id | 6e5f2220-29da-4679-962f-22934f2c3d49 | | ip_version | 4 | | ipv6_address_mode | None | | ipv6_ra_mode | None | | name | net-02 | | network_id | a0fc23dd-f1a5-4e9b-9d58-ea63b30d076b | | project_id | 9d390c83cc4e46c7a40167dee68075f0 | | revision_number | 0 | | segment_id | None | | service_types | | | subnetpool_id | None | | tags | | | updated_at | 2018-04-01T09:21:07Z | +-------------------+--------------------------------------+ Creating nova compute instances We need to know the image names available before creating an instance. List the images available. stack@openstack-instance-2:~/devstack$ openstack image list -f yaml - ID: 2a5fbb6b-b694-4f76-ac19-4af358d1c7e8 Name: cirros-0.3.5-x86_64-disk Status: active Cirros is a tiny image available as part of devstack, useful for testing purpose. Let us create two instances under inside network running cirros image. stack@openstack-instance-2:~/devstack$ openstack server create / --flavor m1.tiny --image cirros-0.3.5-x86_64-disk --network inside host --min 2 --max 2 +-----------------------------+-----------------------------------------------------------------+ | Field | Value | +-----------------------------+-----------------------------------------------------------------+ | OS-DCF:diskConfig | MANUAL | | OS-EXT-AZ:availability_zone | | | OS-EXT-STS:power_state | NOSTATE | | OS-EXT-STS:task_state | scheduling | | OS-EXT-STS:vm_state | building | | OS-SRV-USG:launched_at | None | | OS-SRV-USG:terminated_at | None | | accessIPv4 | | | accessIPv6 | | | addresses | | | adminPass | odJy58yPdHnz | | config_drive | | | created | 2018-04-01T09:25:55Z | | flavor | m1.tiny (1) | | hostId | | | id | dbda4926-4ca6-40be-b673-d0c811ae43c2 | | image | cirros-0.3.5-x86_64-disk (2a5fbb6b-b694-4f76-ac19-4af358d1c7e8) | | key_name | None | | name | host-1 | | progress | 0 | | project_id | 9d390c83cc4e46c7a40167dee68075f0 | | properties | | | security_groups | name=&apos;default&apos; | | status | BUILD | | updated | 2018-04-01T09:25:55Z | | user_id | dfd4e794f59f48549016de1263c30dbb | | volumes_attached | | +-----------------------------+-----------------------------------------------------------------+ Either min or max parameter is necessary. or else server build fails miserably with no clue as to what went wrong. Note that in the above command we specified only the network and not subnet. But this network has two subnets. So let us see which subnet is chosen to run the nova compute instances. stack@openstack-instance-2:~/devstack$ openstack server list -f yaml - Flavor: m1.tiny ID: 5ea3d968-aa29-4911-b658-e0b6498b09f4 Image: cirros-0.3.5-x86_64-disk Name: host-2 Networks: inside=10.1.1.9 Status: ACTIVE - Flavor: m1.tiny ID: dbda4926-4ca6-40be-b673-d0c811ae43c2 Image: cirros-0.3.5-x86_64-disk Name: host-1 Networks: inside=10.1.1.10 Status: ACTIVE It turns out the first subnet net-01 we created is being used. But if we want to specify net-02 for instance creation, it is more tricky. We need to create a port in that subnet and attach its nic during instance creation. stack@openstack-instance-2:~/devstack$ openstack port create \ --network a0fc23dd-f1a5-4e9b-9d58-ea63b30d076b --fixed-ip subnet=6e5f2220-29da-4679-962f-22934f2c3d49 if-host-02 +-----------------------+-------------------------------------------------------------------------+ | Field | Value | +-----------------------+-------------------------------------------------------------------------+ | admin_state_up | UP | | allowed_address_pairs | | | binding_host_id | None | | binding_profile | None | | binding_vif_details | None | | binding_vif_type | None | | binding_vnic_type | normal | | created_at | 2018-04-01T09:32:31Z | | data_plane_status | None | | description | | | device_id | | | device_owner | | | dns_assignment | None | | dns_domain | None | | dns_name | None | | extra_dhcp_opts | | | fixed_ips | ip_address=&apos;10.1.2.5&apos;, subnet_id=&apos;6e5f2220-29da-4679-962f-22934f2c3d49&apos; | | id | 2b9635bf-8f93-4663-9c6d-f40f0492195c | | ip_address | None | | mac_address | fa:16:3e:40:08:73 | | name | if-host-02 | | network_id | a0fc23dd-f1a5-4e9b-9d58-ea63b30d076b | | option_name | None | | option_value | None | | port_security_enabled | True | | project_id | 9d390c83cc4e46c7a40167dee68075f0 | | qos_policy_id | None | | revision_number | 6 | | security_group_ids | bd41b78c-974c-4854-b808-dec11575964b | | status | DOWN | | subnet_id | None | | tags | | | trunk_details | None | | updated_at | 2018-04-01T09:32:31Z | +-----------------------+-------------------------------------------------------------------------+ Now create an instance in this subnet. Use the port id from above output to specify the nic. stack@openstack-instance-2:~/devstack$ openstack server create --flavor m1.tiny \ --image cirros-0.3.5-x86_64-disk --nic port-id=2b9635bf-8f93-4663-9c6d-f40f0492195c host-3 --max 1 +-----------------------------+-----------------------------------------------------------------+ | Field | Value | +-----------------------------+-----------------------------------------------------------------+ | OS-DCF:diskConfig | MANUAL | | OS-EXT-AZ:availability_zone | | | OS-EXT-STS:power_state | NOSTATE | | OS-EXT-STS:task_state | scheduling | | OS-EXT-STS:vm_state | building | | OS-SRV-USG:launched_at | None | | OS-SRV-USG:terminated_at | None | | accessIPv4 | | | accessIPv6 | | | addresses | | | adminPass | hnN294KgUTrY | | config_drive | | | created | 2018-04-01T09:52:23Z | | flavor | m1.tiny (1) | | hostId | | | id | 376c3d59-f74c-4b3b-a4c7-5b9fb9d3eef7 | | image | cirros-0.3.5-x86_64-disk (2a5fbb6b-b694-4f76-ac19-4af358d1c7e8) | | key_name | None | | name | host-3 | | progress | 0 | | project_id | 9d390c83cc4e46c7a40167dee68075f0 | | properties | | | security_groups | name=&apos;default&apos; | | status | BUILD | | updated | 2018-04-01T09:52:23Z | | user_id | dfd4e794f59f48549016de1263c30dbb | | volumes_attached | | +-----------------------------+-----------------------------------------------------------------+ Before we move on to next section, tet us check the server instances we have created so far. stack@openstack-instance-2:~/devstack$ openstack server list -f yaml - Flavor: m1.tiny ID: 376c3d59-f74c-4b3b-a4c7-5b9fb9d3eef7 Image: cirros-0.3.5-x86_64-disk Name: host-3 Networks: inside=10.1.2.5 Status: ACTIVE - Flavor: m1.tiny ID: 5ea3d968-aa29-4911-b658-e0b6498b09f4 Image: cirros-0.3.5-x86_64-disk Name: host-2 Networks: inside=10.1.1.9 Status: ACTIVE - Flavor: m1.tiny ID: dbda4926-4ca6-40be-b673-d0c811ae43c2 Image: cirros-0.3.5-x86_64-disk Name: host-1 Networks: inside=10.1.1.10 Status: ACTIVE Neutron networking between hosts Let us see the subnet membership of each ports. stack@openstack-instance-2:~/devstack$ openstack port list -f yaml --fixed-ip subnet=net-01 - Fixed IP Addresses: &apos;ip_address=&apos;&apos;10.1.1.2&apos;&apos;, subnet_id=&apos;&apos;0317aa4a-84d3-44df-8781-3f04d558a473&apos;&apos; ip_address=&apos;&apos;10.1.2.2&apos;&apos;, subnet_id=&apos;&apos;6e5f2220-29da-4679-962f-22934f2c3d49&apos;&apos;&apos; ID: 6764de9f-deec-494b-a9b4-0903bfbfefea MAC Address: fa:16:3e:8f:47:41 Name: &apos;&apos; Status: ACTIVE - Fixed IP Addresses: ip_address=&apos;10.1.1.9&apos;, subnet_id=&apos;0317aa4a-84d3-44df-8781-3f04d558a473&apos; ID: ab283b4a-5738-48c9-8a53-343a1e5c795d MAC Address: fa:16:3e:9d:b6:7f Name: &apos;&apos; Status: ACTIVE - Fixed IP Addresses: ip_address=&apos;10.1.1.10&apos;, subnet_id=&apos;0317aa4a-84d3-44df-8781-3f04d558a473&apos; ID: de7ee5de-e694-4ff3-9763-d7fb86e0038c MAC Address: fa:16:3e:7a:ce:84 Name: &apos;&apos; Status: ACTIVE stack@openstack-instance-2:~/devstack$ openstack port list -f yaml --fixed-ip subnet=net-02 - Fixed IP Addresses: ip_address=&apos;10.1.2.5&apos;, subnet_id=&apos;6e5f2220-29da-4679-962f-22934f2c3d49&apos; ID: 2b9635bf-8f93-4663-9c6d-f40f0492195c MAC Address: fa:16:3e:40:08:73 Name: if-host-02 Status: ACTIVE - Fixed IP Addresses: &apos;ip_address=&apos;&apos;10.1.1.2&apos;&apos;, subnet_id=&apos;&apos;0317aa4a-84d3-44df-8781-3f04d558a473&apos;&apos; ip_address=&apos;&apos;10.1.2.2&apos;&apos;, subnet_id=&apos;&apos;6e5f2220-29da-4679-962f-22934f2c3d49&apos;&apos;&apos; ID: 6764de9f-deec-494b-a9b4-0903bfbfefea MAC Address: fa:16:3e:8f:47:41 Name: &apos;&apos; Status: ACTIVE We can see that one port appears in both the subnets (MAC address: fa:16:3e:8f:47:41). This is the default DNS server of the network and gets attached to the subnet automatically unless we explicitly specify otherwise. To test connectivity we need to console in to the hosts. We will use virsh to console in to the instances. First let us list the hosts. stack@openstack-instance-2:~/devstack$ sudo virsh list Id Name State ---------------------------------------------------- 1 instance-00000001 running 2 instance-00000002 running 3 instance-00000003 running Console to the first instance host-1. stack@openstack-instance-2:~/devstack$ sudo virsh console 1 Connected to domain instance-00000001 Escape character is ^] login as &apos;cirros&apos; user. default password: &apos;cubswin:)&apos;. use &apos;sudo&apos; for root. cirros login: cirros Password: $ ip add | grep &apos;inet.*10&apos; inet 10.1.1.10/24 brd 10.1.1.255 scope global eth0 $ sudo hostname cirros-1-1-1-10 $ export PS1=&quot;\h$ &quot; We will see that this host can talk to other host host-2 within the same subnet. cirros-1-1-1-10$ ping 10.1.1.9 PING 10.1.1.9 (10.1.1.9): 56 data bytes 64 bytes from 10.1.1.9: seq=0 ttl=64 time=4.409 ms 64 bytes from 10.1.1.9: seq=1 ttl=64 time=1.070 ms 64 bytes from 10.1.1.9: seq=2 ttl=64 time=1.437 ms --- 10.1.1.9 ping statistics --- 3 packets transmitted, 3 packets received, 0% packet loss round-trip min/avg/max = 1.070/2.305/4.409 ms But it cannot reach host-3 which is a different subnet (net-02) cirros-1-1-1-10$ ping 10.1.2.5 PING 10.1.2.5 (10.1.2.5): 56 data bytes --- 10.1.2.5 ping statistics --- 3 packets transmitted, 0 packets received, 100% packet loss Likewise, the host cannot reach external network such as internet. cirros-1-1-1-10$ ping 8.8.8.8 PING 8.8.8.8 (8.8.8.8): 56 data bytes --- 8.8.8.8 ping statistics --- 3 packets transmitted, 0 packets received, 100% packet loss Like in any tradional network, we need a router to allow traffic between different subnets. OpenStack Neutron provides a software defined router which can attach to multiple subnets and provide the same functionality. Let us go ahead and create a router. stack@openstack-instance-2:~/devstack$ openstack router create demo_router +-------------------------+--------------------------------------+ | Field | Value | +-------------------------+--------------------------------------+ | admin_state_up | UP | | availability_zone_hints | | | availability_zones | | | created_at | 2018-04-02T00:14:29Z | | description | | | distributed | False | | external_gateway_info | None | | flavor_id | None | | ha | False | | id | f36a24b0-e4a3-41de-9fdd-73f85df9dbaa | | name | demo_router | | project_id | 9d390c83cc4e46c7a40167dee68075f0 | | revision_number | 1 | | routes | | | status | ACTIVE | | tags | | | updated_at | 2018-04-02T00:14:29Z | +-------------------------+--------------------------------------+ List the routers visible to validate the result. You can see an existing pre-built router and the one we created just now. stack@openstack-instance-2:~/devstack$ openstack router list -f yaml - Distributed: false HA: false ID: 58cc905f-4c8b-4641-ba92-a1a491d818ab Name: router1 Project: 9d390c83cc4e46c7a40167dee68075f0 State: UP Status: ACTIVE - Distributed: false HA: false ID: f36a24b0-e4a3-41de-9fdd-73f85df9dbaa Name: demo_router Project: 9d390c83cc4e46c7a40167dee68075f0 State: UP Status: ACTIVE Now we will attach our subnets to the router. stack@openstack-instance-2:~/devstack$ openstack router add subnet demo_router net-01 stack@openstack-instance-2:~/devstack$ openstack router add subnet demo_router net-02 You can see one new port from each subnet getting attached to the router. stack@openstack-instance-2:~/devstack$ openstack port list -f yaml --router demo_router - Fixed IP Addresses: ip_address=&apos;10.1.1.1&apos;, subnet_id=&apos;0317aa4a-84d3-44df-8781-3f04d558a473&apos; ID: 468ff846-fb1d-4ef2-85b0-3957885c59a8 MAC Address: fa:16:3e:b1:31:fa Name: &apos;&apos; Status: ACTIVE - Fixed IP Addresses: ip_address=&apos;10.1.2.1&apos;, subnet_id=&apos;6e5f2220-29da-4679-962f-22934f2c3d49&apos; ID: ee15064b-26f2-46ae-bc09-02db440edd3b MAC Address: fa:16:3e:7c:62:28 Name: &apos;&apos; Status: ACTIVE To reduce the output I have filtered the port list with an argument –router . Most list commands have ability to filter output like this. Use the interactive help menu to figure out the filter options. Let us try to reach the host on the other network. cirros-1-1-1-10$ ping 10.1.2.5 PING 10.1.2.5 (10.1.2.5): 56 data bytes 64 bytes from 10.1.2.5: seq=0 ttl=63 time=4.141 ms 64 bytes from 10.1.2.5: seq=1 ttl=63 time=1.499 ms --- 10.1.2.5 ping statistics --- 2 packets transmitted, 2 packets received, 0% packet loss round-trip min/avg/max = 1.499/2.820/4.141 ms Success! As expected, the host is one hop away. cirros-1-1-1-10$ traceroute 10.1.2.5 traceroute to 10.1.2.5 (10.1.2.5), 30 hops max, 46 byte packets 1 host-10-1-1-1.openstacklocal (10.1.1.1) 2.217 ms 0.360 ms 0.301 ms 2 host-10-1-2-5.openstacklocal (10.1.2.5) 1.568 ms 1.155 ms 0.803 ms But the outside world connection is not ready yet. For that we need to attach it to a public network. Recall that there was a pre-built public network as part of devstack setup. We will use this network to communicate to outside world. stack@openstack-instance-2:~/devstack$ openstack router set --external-gateway public demo_router stack@openstack-instance-2:~/devstack$ openstack router show demo_router -f yaml admin_state_up: UP availability_zone_hints: &apos;&apos; availability_zones: nova created_at: &apos;2018-04-02T00:14:29Z&apos; description: &apos;&apos; distributed: false external_gateway_info: &apos;{&quot;network_id&quot;: &quot;1fe4e71c-d94e-400c-bcee-8067b621c827&quot;, &quot;enable_snat&quot;: true, &quot;external_fixed_ips&quot;: [{&quot;subnet_id&quot;: &quot;c0718110-7493-46bf-ba48-720762e47934&quot;, &quot;ip_address&quot;: &quot;172.24.4.3&quot;}, {&quot;subnet_id&quot;: &quot;fab15575-ae4f-4528-bf0d-ac40d2000484&quot;, &quot;ip_address&quot;: &quot;2001:db8::6&quot;}]}&apos; flavor_id: null ha: false id: f36a24b0-e4a3-41de-9fdd-73f85df9dbaa interfaces_info: &apos;[{&quot;subnet_id&quot;: &quot;0317aa4a-84d3-44df-8781-3f04d558a473&quot;, &quot;ip_address&quot;: &quot;10.1.1.1&quot;, &quot;port_id&quot;: &quot;468ff846-fb1d-4ef2-85b0-3957885c59a8&quot;}, {&quot;subnet_id&quot;: &quot;6e5f2220-29da-4679-962f-22934f2c3d49&quot;, &quot;ip_address&quot;: &quot;10.1.2.1&quot;, &quot;port_id&quot;: &quot;ee15064b-26f2-46ae-bc09-02db440edd3b&quot;}]&apos; name: demo_router project_id: 9d390c83cc4e46c7a40167dee68075f0 revision_number: 5 routes: &apos;&apos; status: ACTIVE tags: &apos;&apos; updated_at: &apos;2018-04-02T00:32:54Z&apos; The show command is similar to list command, but can show more detailed information about a single resource. As expected, it requires an additional unique identifier argument to identify the resource which we want to display. See that there is a new external_gateway_info section. Now let us try to reach the internet. stack@openstack-instance-2:~/devstack$ sudo virsh console 1 Connected to domain instance-00000001 Escape character is ^] cirros-1-1-1-10$ ping 8.8.8.8 PING 8.8.8.8 (8.8.8.8): 56 data bytes 64 bytes from 8.8.8.8: seq=0 ttl=50 time=7.129 ms 64 bytes from 8.8.8.8: seq=1 ttl=51 time=1.483 ms 64 bytes from 8.8.8.8: seq=2 ttl=51 time=1.137 ms  --- 8.8.8.8 ping statistics --- 3 packets transmitted, 3 packets received, 0% packet loss round-trip min/avg/max = 1.137/3.249/7.129 ms Success! To see how this traffic reaches out to internet, we will do tcpdump on the hypervisor. stack@openstack-instance-2:~/ sudo tcpdump &apos;host 8.8.8.8&apos; -X tcpdump: verbose output suppressed, use -v or -vv for full protocol decode listening on br-ex, link-type EN10MB (Ethernet), capture size 262144 bytes 00:37:14.019550 IP 172.24.4.3 &amp;gt; google-public-dns-a.google.com: ICMP echo request, id 49153, seq 0, length 64 0x0000: 4500 0054 0979 4000 3f01 7205 ac18 0403 E..T.y@.?.r..... 0x0010: 0808 0808 0800 5076 c001 0000 73cd 73ba ......Pv....s.s. 0x0020: 0000 0000 0000 0000 0000 0000 0000 0000 ................ 0x0030: 0000 0000 0000 0000 0000 0000 0000 0000 ................ 0x0040: 0000 0000 0000 0000 0000 0000 0000 0000 ................ 0x0050: 0000 0000 .... 00:37:14.020493 IP google-public-dns-a.google.com &amp;gt; 172.24.4.3: ICMP echo reply, id 49153, seq 0, length 64 0x0000: 4500 0054 0000 0000 3401 c67e 0808 0808 E..T....4..~.... 0x0010: ac18 0403 0000 5876 c001 0000 73cd 73ba ......Xv....s.s. 0x0020: 0000 0000 0000 0000 0000 0000 0000 0000 ................ 0x0030: 0000 0000 0000 0000 0000 0000 0000 0000 ................ 0x0040: 0000 0000 0000 0000 0000 0000 0000 0000 ................ 0x0050: 0000 0000 The traffic from the host is being source NAT by the router to go out to the internet (recall from the earlier output that 172.24.4.3 belongs to the external gateway of the router). In traditional networking term this is called NAT overloading. This can provide only outbound connectivity for the host. In order to provide inbound connectivity to the host, we need to create a floating ip. This is similar to elastic IP in AWS or staic NAT in traditional networking. stack@openstack-instance-2:~/devstack$ openstack floating ip create public +---------------------+--------------------------------------+ | Field | Value | +---------------------+--------------------------------------+ | created_at | 2018-04-02T00:44:14Z | | description | | | fixed_ip_address | None | | floating_ip_address | 172.24.4.5 | | floating_network_id | 1fe4e71c-d94e-400c-bcee-8067b621c827 | | id | e2ff37e4-f8f5-4413-98aa-e0df516c1a3b | | name | 172.24.4.5 | | port_id | None | | project_id | 9d390c83cc4e46c7a40167dee68075f0 | | qos_policy_id | None | | revision_number | 0 | | router_id | None | | status | DOWN | | subnet_id | None | | tags | [] | | updated_at | 2018-04-02T00:44:14Z | +---------------------+--------------------------------------+ Attach this to our host-1 instance. You can now see the floating IP also listed in the openstack server list output. stack@openstack-instance-2:~/devstack$ openstack server add floating ip host-1 172.24.4.5 stack@openstack-instance-2:~/devstack$ openstack server list --name host-1 -f yaml - Flavor: m1.tiny ID: dbda4926-4ca6-40be-b673-d0c811ae43c2 Image: cirros-0.3.5-x86_64-disk Name: host-1 Networks: inside=10.1.1.10, 172.24.4.5 Status: ACTIVE Here you can see the floating ip is mapped to our port-id. stack@openstack-instance-2:~/devstack$ openstack floating ip show 172.24.4.5 +---------------------+--------------------------------------+ | Field | Value | +---------------------+--------------------------------------+ | created_at | 2018-04-02T00:44:14Z | | description | | | fixed_ip_address | 10.1.1.10 | | floating_ip_address | 172.24.4.5 | | floating_network_id | 1fe4e71c-d94e-400c-bcee-8067b621c827 | | id | e2ff37e4-f8f5-4413-98aa-e0df516c1a3b | | name | 172.24.4.5 | | port_id | de7ee5de-e694-4ff3-9763-d7fb86e0038c | | project_id | 9d390c83cc4e46c7a40167dee68075f0 | | qos_policy_id | None | | revision_number | 2 | | router_id | f36a24b0-e4a3-41de-9fdd-73f85df9dbaa | | status | ACTIVE | | subnet_id | None | | tags | [] | | updated_at | 2018-04-02T00:47:14Z | +---------------------+--------------------------------------+ We require one last step to initiate inbound connections to the host. Recall that each ports are assigned with a security group. Since this is an inbound connection, we need to explicitly permit access in security group. Check the Security Group assigned to our port. stack@openstack-instance-2:~/devstack$ openstack port \show de7ee5de-e694-4ff3-9763-d7fb86e0038c -c &apos;security_group_ids&apos; -f yaml security_group_ids: bd41b78c-974c-4854-b808-dec11575964b Let us see the rules which are permitted by this security group. stack@openstack-instance-2:~/devstack$ openstack security group show bd41b78c-974c-4854-b808-dec11575964b -f yaml created_at: &apos;2018-04-01T09:01:20Z&apos; description: Default security group id: bd41b78c-974c-4854-b808-dec11575964b name: default project_id: 9d390c83cc4e46c7a40167dee68075f0 revision_number: 6 rules: &apos;created_at=&apos;&apos;2018-04-01T09:01:20Z&apos;&apos;, direction=&apos;&apos;ingress&apos;&apos;, ethertype=&apos;&apos;IPv4&apos;&apos;, id=&apos;&apos;2ab4f8a5-43ed-4f3e-8c43-cc854bc8feb3&apos;&apos;, remote_group_id=&apos;&apos;bd41b78c-974c-4854-b808-dec11575964b&apos;&apos;, updated_at=&apos;&apos;2018-04-01T09:01:20Z&apos;&apos; created_at=&apos;&apos;2018-04-01T09:01:20Z&apos;&apos;, direction=&apos;&apos;egress&apos;&apos;, ethertype=&apos;&apos;IPv6&apos;&apos;, id=&apos;&apos;5c33d0ac-8ee9-4bd7-951c-dca998931828&apos;&apos;, updated_at=&apos;&apos;2018-04-01T09:01:20Z&apos;&apos; created_at=&apos;&apos;2018-04-01T09:01:20Z&apos;&apos;, direction=&apos;&apos;ingress&apos;&apos;, ethertype=&apos;&apos;IPv6&apos;&apos;, id=&apos;&apos;d7c7a642-485b-482e-8d26-a958aaafa19e&apos;&apos;, remote_group_id=&apos;&apos;bd41b78c-974c-4854-b808-dec11575964b&apos;&apos;, updated_at=&apos;&apos;2018-04-01T09:01:20Z&apos;&apos; created_at=&apos;&apos;2018-04-01T09:01:20Z&apos;&apos;, direction=&apos;&apos;egress&apos;&apos;, ethertype=&apos;&apos;IPv4&apos;&apos;, id=&apos;&apos;f41405df-d0c9-4427-ba11-f0a26b025c3e&apos;&apos;, updated_at=&apos;&apos;2018-04-01T09:01:20Z&apos;&apos;&apos; tags: [] updated_at: &apos;2018-04-02T01:56:25Z&apos; Here you can see 4 rules, two each for IPv4 and IPv6. For egress rules, you can see that there is no remote prefix or group id configured. It means all outbound connections are permitted. For ingress traffic, you can see that the remote_group_id references to self. It means that all ports assigned to the same security group can send inbound traffic unhindered. Let us add more rules to permit ICMP and SSH stack@openstack-instance-2:~/devstack$ openstack security group rule create \ --protocol icmp --ingress --remote-ip 0.0.0.0/0 default +-------------------+--------------------------------------+ | Field | Value | +-------------------+--------------------------------------+ | created_at | 2018-04-02T01:54:12Z | | description | | | direction | ingress | | ether_type | IPv4 | | id | df23fec9-b87a-47ef-8f38-67472de46071 | | name | None | | port_range_max | None | | port_range_min | None | | project_id | 9d390c83cc4e46c7a40167dee68075f0 | | protocol | icmp | | remote_group_id | None | | remote_ip_prefix | 0.0.0.0/0 | | revision_number | 0 | | security_group_id | bd41b78c-974c-4854-b808-dec11575964b | | updated_at | 2018-04-02T01:54:12Z | +-------------------+--------------------------------------+ stack@openstack-instance-2:~/devstack$ openstack security group rule create \ --protocol tcp --dst-port 22 --ingress --remote-ip 0.0.0.0/0 default +-------------------+--------------------------------------+ | Field | Value | +-------------------+--------------------------------------+ | created_at | 2018-04-02T01:56:25Z | | description | | | direction | ingress | | ether_type | IPv4 | | id | adee3f3f-a5a0-497f-a12d-644e64c7015e | | name | None | | port_range_max | 22 | | port_range_min | 22 | | project_id | 9d390c83cc4e46c7a40167dee68075f0 | | protocol | tcp | | remote_group_id | None | | remote_ip_prefix | 0.0.0.0/0 | | revision_number | 0 | | security_group_id | bd41b78c-974c-4854-b808-dec11575964b | | updated_at | 2018-04-02T01:56:25Z | +-------------------+--------------------------------------+ Note that I am using the security group name default as argument instead of security group id. As with most other arguments, we can use either name or the id. We can find the name from the output of previous show command. Now you can see 2 new rules added to the group stack@openstack-instance-2:~/devstack$ openstack security group rule list -c &apos;IP Protocol&apos; -c &apos;IP Range&apos; -c &apos;Port Range&apos; -f yaml - IP Protocol: null IP Range: null Port Range: &apos;&apos; - IP Protocol: null IP Range: null Port Range: &apos;&apos; - IP Protocol: tcp IP Range: 0.0.0.0/0 Port Range: &apos;22:22&apos; - IP Protocol: null IP Range: null Port Range: &apos;&apos; - IP Protocol: icmp IP Range: 0.0.0.0/0 Port Range: &apos;&apos; - IP Protocol: null IP Range: null Port Range: &apos;&apos; Note that in the previous list command output, there were lot of fields. Here I have used -c argument to select the interesting fields. To select multiple columns, we have to repeat this -c argument. Now we can initiate SSH and ICMP connections to this VM host using floating ip address. stack@openstack-instance-2:~/devstack$ ping 172.24.4.5 PING 172.24.4.5 (172.24.4.5) 56(84) bytes of data. 64 bytes from 172.24.4.5: icmp_seq=1 ttl=63 time=0.628 ms 64 bytes from 172.24.4.5: icmp_seq=2 ttl=63 time=0.529 ms ^C --- 172.24.4.5 ping statistics --- 2 packets transmitted, 2 received, 0% packet loss, time 1003ms rtt min/avg/max/mdev = 0.529/0.578/0.628/0.055 ms stack@openstack-instance-2:~/devstack$ ssh cirros@172.24.4.5 cirros@172.24.4.5&apos;s password: cirros-1-1-1-10$ Recall that the hosts were able to ping each other even before we updated the security group. It is because all the ports were assigned to the default security group and hosts on security group can talk to each other by virtue of an implicit rule. Conclusion I have barely scratched the surface of things possible with Openstack. However, this post should give a good idea about the general command structure and operation procedures in Openstack. For further learning, dig around the official documentation (pay attention to openstack version in the docs, there can be major differences between each versions) or setup a lab environment and play around. On the Neutron front, there are a lot of topics to explore such as ML2 network types, virtual switch types, L3 agents etc., Redhat’s official documentation provides a good introduction to many of these components.">
<meta name="keywords" content="openstack, software defined networking, networking">
<meta property="og:type" content="article">
<meta property="og:title" content="Introduction to OpenStack Networking for Network Engineers">
<meta property="og:url" content="http://localhost:4000/networking/2018/03/22/2018-03-22-introduction-to-openstack-networking-for-network-engineers/">
<meta property="og:site_name" content="Ephemeral Electrons">
<meta property="og:description" content="Introduction This post is a gentle introduction to networking with Openstack using the Neutron module. Being an introduction, we will not focus on setting up OpenStack from scratch. Instead we will familiarize ourselves with core concepts of Neutron and common administrative tasks. We will use the latest release of Openstack, Queens. For ease of setup, we will make use of pre-packaged Devstack environment. Devstack is a set of scripts from official OpenStack community that allows us to quickly build an Openstack instance with latest versions of all modules. It is very useful for testing and training purposes. Neutron Concepts Let us go through the important terms first: Network - A Network is a logical container of entities. To think of it in physical networking terms, it can represent a site, a DC, a campus- or anything else termed as a single network. In AWS terms, a network is similar to a VPC. Note that the definition of a Network is not entirely arbitrary as we may encounter some design choices when deciding CIDR, load balancers, routers, external gateway etc., Subnet - Subnet is similar to a vlan in traditional networking. All hosts in the same Subnet can talk to each other and share the same address space. For beginners, it is possible to confuse a Subnet with Network since both terms are used interchangeably in traditional networking. But keep in mind that one network can contain many subnets. The concept of a Subnet is similar both in OpenStack and AWS. Port - A port is a virtual NIC card which is used by resources to access network. A port is tied to a subnet and assigned with a Security group (introduced below). In AWS terms, it is similar to ENI (Elastic Network Interface) Security Group - Security groups are like port ACL in traditional networking, except that the filtering happens at the hypervisor level. Multiple ports can share the same security group. By default, entities assigned to the same Security Group can talk to each other. It is also similar in scope and function to the Security Group in AWS. Floating IP - This is similar to elastic IP in AWS. These are not tied to any port and can be re-assigned to other ports dynamically. The closest feature in traditional networking would be a static NAT. In AWS terms, it is called Elastic IP. Objective We will create the below topology on Openstack. Hosts host-1 &amp;amp; host-2 will be on same subnet while host-3 will be on another subnet. We will enable reachability between all 3 hosts. Finally, we will also enable bi-directional connectivity to host-1 from internet. Preparing the environment Make home directory for our devstack installation and download the latest copy of DevStack there. I am using Ubuntu 16.04 for my environment. $ sudo mkdir -p /opt/stack &amp;amp;&amp;amp; cd /opt/stack $ sudo git clone https://git.openstack.org/openstack-dev/devstack Switch to devstack folder and create a user account using the pre-built script. The script grants passwordless root privilege to this account. Switch to the stack account to proceed with rest of the steps. $ cd devstack $ sudo bash tools/create-stack-user.sh Switch to stack user and create a config file. Provide your preferred password which will be used for rest of the setup. The local.conf should be present in the root directory of devstack (same location as stack.sh) $ sudo su stack $ vi local.conf [[local|localrc]] ADMIN_PASSWORD=password DATABASE_PASSWORD=$ADMIN_PASSWORD RABBIT_PASSWORD=$ADMIN_PASSWORD SERVICE_PASSWORD=$ADMIN_PASSWORD Run the setup script stack.sh and watch the magic happen. It takes a while since the script installs almost every component of Openstack. ./stack.sh DevStack also provides convenient script to tear down the environment and start from scratch. So once we are done with our testing, we can run unstack.sh to bring the environment back to a blank state. After the installation is complete, source the openrc file to import openstack commands in your searchpath. source openrc Building subnets Before we create new subnets, let us list the set of pre-built subnets that were setup as part of devstack deployment. stack@openstack-instance-2:~/devstack$ openstack network list -f yaml - ID: 1fe4e71c-d94e-400c-bcee-8067b621c827 Name: public Subnets: c0718110-7493-46bf-ba48-720762e47934, fab15575-ae4f-4528-bf0d-ac40d2000484 - ID: 2ebe2084-6dae-40dd-8704-7954944238d7 Name: private Subnets: 244ed014-8b9f-4e4d-ab12-9931ecec4238, 265de598-d881-4d58-a185-1a69be39b2fd The default output format is table. To simplify horizontal scrolling, I have selected yaml output using the -f switch. Create a new network called inside. stack@openstack-instance-2:~/devstack$ openstack network create inside +---------------------------+--------------------------------------+ | Field | Value | +---------------------------+--------------------------------------+ | admin_state_up | UP | | availability_zone_hints | | | availability_zones | | | created_at | 2018-04-01T09:14:41Z | | description | | | dns_domain | None | | id | a0fc23dd-f1a5-4e9b-9d58-ea63b30d076b | | ipv4_address_scope | None | | ipv6_address_scope | None | | is_default | False | | is_vlan_transparent | None | | mtu | 1450 | | name | inside | | port_security_enabled | True | | project_id | 9d390c83cc4e46c7a40167dee68075f0 | | provider:network_type | None | | provider:physical_network | None | | provider:segmentation_id | None | | qos_policy_id | None | | revision_number | 2 | | router:external | Internal | | segments | None | | shared | False | | status | ACTIVE | | subnets | | | tags | | | updated_at | 2018-04-01T09:14:41Z | +---------------------------+--------------------------------------+ Next we will create new subnets. Before that, let us list down the existing subnets for reference. stack@openstack-instance-2:~/devstack$ openstack subnet list -f yaml - ID: 244ed014-8b9f-4e4d-ab12-9931ecec4238 Name: private-subnet Network: 2ebe2084-6dae-40dd-8704-7954944238d7 Subnet: 10.0.0.0/26 - ID: 265de598-d881-4d58-a185-1a69be39b2fd Name: ipv6-private-subnet Network: 2ebe2084-6dae-40dd-8704-7954944238d7 Subnet: fd7b:34b0:9a57::/64 Create a new subnet within the network. We will call it net-01 and assign a subnet range of 10.1.1.0/24 stack@openstack-instance-2:~/devstack$ openstack subnet create net-01 --network inside --subnet-range 10.1.1.0/24 +-------------------+--------------------------------------+ | Field | Value | +-------------------+--------------------------------------+ | allocation_pools | 10.1.1.2-10.1.1.254 | | cidr | 10.1.1.0/24 | | created_at | 2018-04-01T09:20:13Z | | description | | | dns_nameservers | | | enable_dhcp | True | | gateway_ip | 10.1.1.1 | | host_routes | | | id | 0317aa4a-84d3-44df-8781-3f04d558a473 | | ip_version | 4 | | ipv6_address_mode | None | | ipv6_ra_mode | None | | name | net-01 | | network_id | a0fc23dd-f1a5-4e9b-9d58-ea63b30d076b | | project_id | 9d390c83cc4e46c7a40167dee68075f0 | | revision_number | 0 | | segment_id | None | | service_types | | | subnetpool_id | None | | tags | | | updated_at | 2018-04-01T09:20:13Z | +-------------------+--------------------------------------+ As mentioned earlier, the relation between subnet and network is many-to-one. So we can create another subnet net-02 within the same inside network. stack@openstack-instance-2:~/devstack$ openstack subnet create net-02 --network inside --subnet-range 10.1.2.0/24 +-------------------+--------------------------------------+ | Field | Value | +-------------------+--------------------------------------+ | allocation_pools | 10.1.2.2-10.1.2.254 | | cidr | 10.1.2.0/24 | | created_at | 2018-04-01T09:21:07Z | | description | | | dns_nameservers | | | enable_dhcp | True | | gateway_ip | 10.1.2.1 | | host_routes | | | id | 6e5f2220-29da-4679-962f-22934f2c3d49 | | ip_version | 4 | | ipv6_address_mode | None | | ipv6_ra_mode | None | | name | net-02 | | network_id | a0fc23dd-f1a5-4e9b-9d58-ea63b30d076b | | project_id | 9d390c83cc4e46c7a40167dee68075f0 | | revision_number | 0 | | segment_id | None | | service_types | | | subnetpool_id | None | | tags | | | updated_at | 2018-04-01T09:21:07Z | +-------------------+--------------------------------------+ Creating nova compute instances We need to know the image names available before creating an instance. List the images available. stack@openstack-instance-2:~/devstack$ openstack image list -f yaml - ID: 2a5fbb6b-b694-4f76-ac19-4af358d1c7e8 Name: cirros-0.3.5-x86_64-disk Status: active Cirros is a tiny image available as part of devstack, useful for testing purpose. Let us create two instances under inside network running cirros image. stack@openstack-instance-2:~/devstack$ openstack server create / --flavor m1.tiny --image cirros-0.3.5-x86_64-disk --network inside host --min 2 --max 2 +-----------------------------+-----------------------------------------------------------------+ | Field | Value | +-----------------------------+-----------------------------------------------------------------+ | OS-DCF:diskConfig | MANUAL | | OS-EXT-AZ:availability_zone | | | OS-EXT-STS:power_state | NOSTATE | | OS-EXT-STS:task_state | scheduling | | OS-EXT-STS:vm_state | building | | OS-SRV-USG:launched_at | None | | OS-SRV-USG:terminated_at | None | | accessIPv4 | | | accessIPv6 | | | addresses | | | adminPass | odJy58yPdHnz | | config_drive | | | created | 2018-04-01T09:25:55Z | | flavor | m1.tiny (1) | | hostId | | | id | dbda4926-4ca6-40be-b673-d0c811ae43c2 | | image | cirros-0.3.5-x86_64-disk (2a5fbb6b-b694-4f76-ac19-4af358d1c7e8) | | key_name | None | | name | host-1 | | progress | 0 | | project_id | 9d390c83cc4e46c7a40167dee68075f0 | | properties | | | security_groups | name=&apos;default&apos; | | status | BUILD | | updated | 2018-04-01T09:25:55Z | | user_id | dfd4e794f59f48549016de1263c30dbb | | volumes_attached | | +-----------------------------+-----------------------------------------------------------------+ Either min or max parameter is necessary. or else server build fails miserably with no clue as to what went wrong. Note that in the above command we specified only the network and not subnet. But this network has two subnets. So let us see which subnet is chosen to run the nova compute instances. stack@openstack-instance-2:~/devstack$ openstack server list -f yaml - Flavor: m1.tiny ID: 5ea3d968-aa29-4911-b658-e0b6498b09f4 Image: cirros-0.3.5-x86_64-disk Name: host-2 Networks: inside=10.1.1.9 Status: ACTIVE - Flavor: m1.tiny ID: dbda4926-4ca6-40be-b673-d0c811ae43c2 Image: cirros-0.3.5-x86_64-disk Name: host-1 Networks: inside=10.1.1.10 Status: ACTIVE It turns out the first subnet net-01 we created is being used. But if we want to specify net-02 for instance creation, it is more tricky. We need to create a port in that subnet and attach its nic during instance creation. stack@openstack-instance-2:~/devstack$ openstack port create \ --network a0fc23dd-f1a5-4e9b-9d58-ea63b30d076b --fixed-ip subnet=6e5f2220-29da-4679-962f-22934f2c3d49 if-host-02 +-----------------------+-------------------------------------------------------------------------+ | Field | Value | +-----------------------+-------------------------------------------------------------------------+ | admin_state_up | UP | | allowed_address_pairs | | | binding_host_id | None | | binding_profile | None | | binding_vif_details | None | | binding_vif_type | None | | binding_vnic_type | normal | | created_at | 2018-04-01T09:32:31Z | | data_plane_status | None | | description | | | device_id | | | device_owner | | | dns_assignment | None | | dns_domain | None | | dns_name | None | | extra_dhcp_opts | | | fixed_ips | ip_address=&apos;10.1.2.5&apos;, subnet_id=&apos;6e5f2220-29da-4679-962f-22934f2c3d49&apos; | | id | 2b9635bf-8f93-4663-9c6d-f40f0492195c | | ip_address | None | | mac_address | fa:16:3e:40:08:73 | | name | if-host-02 | | network_id | a0fc23dd-f1a5-4e9b-9d58-ea63b30d076b | | option_name | None | | option_value | None | | port_security_enabled | True | | project_id | 9d390c83cc4e46c7a40167dee68075f0 | | qos_policy_id | None | | revision_number | 6 | | security_group_ids | bd41b78c-974c-4854-b808-dec11575964b | | status | DOWN | | subnet_id | None | | tags | | | trunk_details | None | | updated_at | 2018-04-01T09:32:31Z | +-----------------------+-------------------------------------------------------------------------+ Now create an instance in this subnet. Use the port id from above output to specify the nic. stack@openstack-instance-2:~/devstack$ openstack server create --flavor m1.tiny \ --image cirros-0.3.5-x86_64-disk --nic port-id=2b9635bf-8f93-4663-9c6d-f40f0492195c host-3 --max 1 +-----------------------------+-----------------------------------------------------------------+ | Field | Value | +-----------------------------+-----------------------------------------------------------------+ | OS-DCF:diskConfig | MANUAL | | OS-EXT-AZ:availability_zone | | | OS-EXT-STS:power_state | NOSTATE | | OS-EXT-STS:task_state | scheduling | | OS-EXT-STS:vm_state | building | | OS-SRV-USG:launched_at | None | | OS-SRV-USG:terminated_at | None | | accessIPv4 | | | accessIPv6 | | | addresses | | | adminPass | hnN294KgUTrY | | config_drive | | | created | 2018-04-01T09:52:23Z | | flavor | m1.tiny (1) | | hostId | | | id | 376c3d59-f74c-4b3b-a4c7-5b9fb9d3eef7 | | image | cirros-0.3.5-x86_64-disk (2a5fbb6b-b694-4f76-ac19-4af358d1c7e8) | | key_name | None | | name | host-3 | | progress | 0 | | project_id | 9d390c83cc4e46c7a40167dee68075f0 | | properties | | | security_groups | name=&apos;default&apos; | | status | BUILD | | updated | 2018-04-01T09:52:23Z | | user_id | dfd4e794f59f48549016de1263c30dbb | | volumes_attached | | +-----------------------------+-----------------------------------------------------------------+ Before we move on to next section, tet us check the server instances we have created so far. stack@openstack-instance-2:~/devstack$ openstack server list -f yaml - Flavor: m1.tiny ID: 376c3d59-f74c-4b3b-a4c7-5b9fb9d3eef7 Image: cirros-0.3.5-x86_64-disk Name: host-3 Networks: inside=10.1.2.5 Status: ACTIVE - Flavor: m1.tiny ID: 5ea3d968-aa29-4911-b658-e0b6498b09f4 Image: cirros-0.3.5-x86_64-disk Name: host-2 Networks: inside=10.1.1.9 Status: ACTIVE - Flavor: m1.tiny ID: dbda4926-4ca6-40be-b673-d0c811ae43c2 Image: cirros-0.3.5-x86_64-disk Name: host-1 Networks: inside=10.1.1.10 Status: ACTIVE Neutron networking between hosts Let us see the subnet membership of each ports. stack@openstack-instance-2:~/devstack$ openstack port list -f yaml --fixed-ip subnet=net-01 - Fixed IP Addresses: &apos;ip_address=&apos;&apos;10.1.1.2&apos;&apos;, subnet_id=&apos;&apos;0317aa4a-84d3-44df-8781-3f04d558a473&apos;&apos; ip_address=&apos;&apos;10.1.2.2&apos;&apos;, subnet_id=&apos;&apos;6e5f2220-29da-4679-962f-22934f2c3d49&apos;&apos;&apos; ID: 6764de9f-deec-494b-a9b4-0903bfbfefea MAC Address: fa:16:3e:8f:47:41 Name: &apos;&apos; Status: ACTIVE - Fixed IP Addresses: ip_address=&apos;10.1.1.9&apos;, subnet_id=&apos;0317aa4a-84d3-44df-8781-3f04d558a473&apos; ID: ab283b4a-5738-48c9-8a53-343a1e5c795d MAC Address: fa:16:3e:9d:b6:7f Name: &apos;&apos; Status: ACTIVE - Fixed IP Addresses: ip_address=&apos;10.1.1.10&apos;, subnet_id=&apos;0317aa4a-84d3-44df-8781-3f04d558a473&apos; ID: de7ee5de-e694-4ff3-9763-d7fb86e0038c MAC Address: fa:16:3e:7a:ce:84 Name: &apos;&apos; Status: ACTIVE stack@openstack-instance-2:~/devstack$ openstack port list -f yaml --fixed-ip subnet=net-02 - Fixed IP Addresses: ip_address=&apos;10.1.2.5&apos;, subnet_id=&apos;6e5f2220-29da-4679-962f-22934f2c3d49&apos; ID: 2b9635bf-8f93-4663-9c6d-f40f0492195c MAC Address: fa:16:3e:40:08:73 Name: if-host-02 Status: ACTIVE - Fixed IP Addresses: &apos;ip_address=&apos;&apos;10.1.1.2&apos;&apos;, subnet_id=&apos;&apos;0317aa4a-84d3-44df-8781-3f04d558a473&apos;&apos; ip_address=&apos;&apos;10.1.2.2&apos;&apos;, subnet_id=&apos;&apos;6e5f2220-29da-4679-962f-22934f2c3d49&apos;&apos;&apos; ID: 6764de9f-deec-494b-a9b4-0903bfbfefea MAC Address: fa:16:3e:8f:47:41 Name: &apos;&apos; Status: ACTIVE We can see that one port appears in both the subnets (MAC address: fa:16:3e:8f:47:41). This is the default DNS server of the network and gets attached to the subnet automatically unless we explicitly specify otherwise. To test connectivity we need to console in to the hosts. We will use virsh to console in to the instances. First let us list the hosts. stack@openstack-instance-2:~/devstack$ sudo virsh list Id Name State ---------------------------------------------------- 1 instance-00000001 running 2 instance-00000002 running 3 instance-00000003 running Console to the first instance host-1. stack@openstack-instance-2:~/devstack$ sudo virsh console 1 Connected to domain instance-00000001 Escape character is ^] login as &apos;cirros&apos; user. default password: &apos;cubswin:)&apos;. use &apos;sudo&apos; for root. cirros login: cirros Password: $ ip add | grep &apos;inet.*10&apos; inet 10.1.1.10/24 brd 10.1.1.255 scope global eth0 $ sudo hostname cirros-1-1-1-10 $ export PS1=&quot;\h$ &quot; We will see that this host can talk to other host host-2 within the same subnet. cirros-1-1-1-10$ ping 10.1.1.9 PING 10.1.1.9 (10.1.1.9): 56 data bytes 64 bytes from 10.1.1.9: seq=0 ttl=64 time=4.409 ms 64 bytes from 10.1.1.9: seq=1 ttl=64 time=1.070 ms 64 bytes from 10.1.1.9: seq=2 ttl=64 time=1.437 ms --- 10.1.1.9 ping statistics --- 3 packets transmitted, 3 packets received, 0% packet loss round-trip min/avg/max = 1.070/2.305/4.409 ms But it cannot reach host-3 which is a different subnet (net-02) cirros-1-1-1-10$ ping 10.1.2.5 PING 10.1.2.5 (10.1.2.5): 56 data bytes --- 10.1.2.5 ping statistics --- 3 packets transmitted, 0 packets received, 100% packet loss Likewise, the host cannot reach external network such as internet. cirros-1-1-1-10$ ping 8.8.8.8 PING 8.8.8.8 (8.8.8.8): 56 data bytes --- 8.8.8.8 ping statistics --- 3 packets transmitted, 0 packets received, 100% packet loss Like in any tradional network, we need a router to allow traffic between different subnets. OpenStack Neutron provides a software defined router which can attach to multiple subnets and provide the same functionality. Let us go ahead and create a router. stack@openstack-instance-2:~/devstack$ openstack router create demo_router +-------------------------+--------------------------------------+ | Field | Value | +-------------------------+--------------------------------------+ | admin_state_up | UP | | availability_zone_hints | | | availability_zones | | | created_at | 2018-04-02T00:14:29Z | | description | | | distributed | False | | external_gateway_info | None | | flavor_id | None | | ha | False | | id | f36a24b0-e4a3-41de-9fdd-73f85df9dbaa | | name | demo_router | | project_id | 9d390c83cc4e46c7a40167dee68075f0 | | revision_number | 1 | | routes | | | status | ACTIVE | | tags | | | updated_at | 2018-04-02T00:14:29Z | +-------------------------+--------------------------------------+ List the routers visible to validate the result. You can see an existing pre-built router and the one we created just now. stack@openstack-instance-2:~/devstack$ openstack router list -f yaml - Distributed: false HA: false ID: 58cc905f-4c8b-4641-ba92-a1a491d818ab Name: router1 Project: 9d390c83cc4e46c7a40167dee68075f0 State: UP Status: ACTIVE - Distributed: false HA: false ID: f36a24b0-e4a3-41de-9fdd-73f85df9dbaa Name: demo_router Project: 9d390c83cc4e46c7a40167dee68075f0 State: UP Status: ACTIVE Now we will attach our subnets to the router. stack@openstack-instance-2:~/devstack$ openstack router add subnet demo_router net-01 stack@openstack-instance-2:~/devstack$ openstack router add subnet demo_router net-02 You can see one new port from each subnet getting attached to the router. stack@openstack-instance-2:~/devstack$ openstack port list -f yaml --router demo_router - Fixed IP Addresses: ip_address=&apos;10.1.1.1&apos;, subnet_id=&apos;0317aa4a-84d3-44df-8781-3f04d558a473&apos; ID: 468ff846-fb1d-4ef2-85b0-3957885c59a8 MAC Address: fa:16:3e:b1:31:fa Name: &apos;&apos; Status: ACTIVE - Fixed IP Addresses: ip_address=&apos;10.1.2.1&apos;, subnet_id=&apos;6e5f2220-29da-4679-962f-22934f2c3d49&apos; ID: ee15064b-26f2-46ae-bc09-02db440edd3b MAC Address: fa:16:3e:7c:62:28 Name: &apos;&apos; Status: ACTIVE To reduce the output I have filtered the port list with an argument –router . Most list commands have ability to filter output like this. Use the interactive help menu to figure out the filter options. Let us try to reach the host on the other network. cirros-1-1-1-10$ ping 10.1.2.5 PING 10.1.2.5 (10.1.2.5): 56 data bytes 64 bytes from 10.1.2.5: seq=0 ttl=63 time=4.141 ms 64 bytes from 10.1.2.5: seq=1 ttl=63 time=1.499 ms --- 10.1.2.5 ping statistics --- 2 packets transmitted, 2 packets received, 0% packet loss round-trip min/avg/max = 1.499/2.820/4.141 ms Success! As expected, the host is one hop away. cirros-1-1-1-10$ traceroute 10.1.2.5 traceroute to 10.1.2.5 (10.1.2.5), 30 hops max, 46 byte packets 1 host-10-1-1-1.openstacklocal (10.1.1.1) 2.217 ms 0.360 ms 0.301 ms 2 host-10-1-2-5.openstacklocal (10.1.2.5) 1.568 ms 1.155 ms 0.803 ms But the outside world connection is not ready yet. For that we need to attach it to a public network. Recall that there was a pre-built public network as part of devstack setup. We will use this network to communicate to outside world. stack@openstack-instance-2:~/devstack$ openstack router set --external-gateway public demo_router stack@openstack-instance-2:~/devstack$ openstack router show demo_router -f yaml admin_state_up: UP availability_zone_hints: &apos;&apos; availability_zones: nova created_at: &apos;2018-04-02T00:14:29Z&apos; description: &apos;&apos; distributed: false external_gateway_info: &apos;{&quot;network_id&quot;: &quot;1fe4e71c-d94e-400c-bcee-8067b621c827&quot;, &quot;enable_snat&quot;: true, &quot;external_fixed_ips&quot;: [{&quot;subnet_id&quot;: &quot;c0718110-7493-46bf-ba48-720762e47934&quot;, &quot;ip_address&quot;: &quot;172.24.4.3&quot;}, {&quot;subnet_id&quot;: &quot;fab15575-ae4f-4528-bf0d-ac40d2000484&quot;, &quot;ip_address&quot;: &quot;2001:db8::6&quot;}]}&apos; flavor_id: null ha: false id: f36a24b0-e4a3-41de-9fdd-73f85df9dbaa interfaces_info: &apos;[{&quot;subnet_id&quot;: &quot;0317aa4a-84d3-44df-8781-3f04d558a473&quot;, &quot;ip_address&quot;: &quot;10.1.1.1&quot;, &quot;port_id&quot;: &quot;468ff846-fb1d-4ef2-85b0-3957885c59a8&quot;}, {&quot;subnet_id&quot;: &quot;6e5f2220-29da-4679-962f-22934f2c3d49&quot;, &quot;ip_address&quot;: &quot;10.1.2.1&quot;, &quot;port_id&quot;: &quot;ee15064b-26f2-46ae-bc09-02db440edd3b&quot;}]&apos; name: demo_router project_id: 9d390c83cc4e46c7a40167dee68075f0 revision_number: 5 routes: &apos;&apos; status: ACTIVE tags: &apos;&apos; updated_at: &apos;2018-04-02T00:32:54Z&apos; The show command is similar to list command, but can show more detailed information about a single resource. As expected, it requires an additional unique identifier argument to identify the resource which we want to display. See that there is a new external_gateway_info section. Now let us try to reach the internet. stack@openstack-instance-2:~/devstack$ sudo virsh console 1 Connected to domain instance-00000001 Escape character is ^] cirros-1-1-1-10$ ping 8.8.8.8 PING 8.8.8.8 (8.8.8.8): 56 data bytes 64 bytes from 8.8.8.8: seq=0 ttl=50 time=7.129 ms 64 bytes from 8.8.8.8: seq=1 ttl=51 time=1.483 ms 64 bytes from 8.8.8.8: seq=2 ttl=51 time=1.137 ms  --- 8.8.8.8 ping statistics --- 3 packets transmitted, 3 packets received, 0% packet loss round-trip min/avg/max = 1.137/3.249/7.129 ms Success! To see how this traffic reaches out to internet, we will do tcpdump on the hypervisor. stack@openstack-instance-2:~/ sudo tcpdump &apos;host 8.8.8.8&apos; -X tcpdump: verbose output suppressed, use -v or -vv for full protocol decode listening on br-ex, link-type EN10MB (Ethernet), capture size 262144 bytes 00:37:14.019550 IP 172.24.4.3 &amp;gt; google-public-dns-a.google.com: ICMP echo request, id 49153, seq 0, length 64 0x0000: 4500 0054 0979 4000 3f01 7205 ac18 0403 E..T.y@.?.r..... 0x0010: 0808 0808 0800 5076 c001 0000 73cd 73ba ......Pv....s.s. 0x0020: 0000 0000 0000 0000 0000 0000 0000 0000 ................ 0x0030: 0000 0000 0000 0000 0000 0000 0000 0000 ................ 0x0040: 0000 0000 0000 0000 0000 0000 0000 0000 ................ 0x0050: 0000 0000 .... 00:37:14.020493 IP google-public-dns-a.google.com &amp;gt; 172.24.4.3: ICMP echo reply, id 49153, seq 0, length 64 0x0000: 4500 0054 0000 0000 3401 c67e 0808 0808 E..T....4..~.... 0x0010: ac18 0403 0000 5876 c001 0000 73cd 73ba ......Xv....s.s. 0x0020: 0000 0000 0000 0000 0000 0000 0000 0000 ................ 0x0030: 0000 0000 0000 0000 0000 0000 0000 0000 ................ 0x0040: 0000 0000 0000 0000 0000 0000 0000 0000 ................ 0x0050: 0000 0000 The traffic from the host is being source NAT by the router to go out to the internet (recall from the earlier output that 172.24.4.3 belongs to the external gateway of the router). In traditional networking term this is called NAT overloading. This can provide only outbound connectivity for the host. In order to provide inbound connectivity to the host, we need to create a floating ip. This is similar to elastic IP in AWS or staic NAT in traditional networking. stack@openstack-instance-2:~/devstack$ openstack floating ip create public +---------------------+--------------------------------------+ | Field | Value | +---------------------+--------------------------------------+ | created_at | 2018-04-02T00:44:14Z | | description | | | fixed_ip_address | None | | floating_ip_address | 172.24.4.5 | | floating_network_id | 1fe4e71c-d94e-400c-bcee-8067b621c827 | | id | e2ff37e4-f8f5-4413-98aa-e0df516c1a3b | | name | 172.24.4.5 | | port_id | None | | project_id | 9d390c83cc4e46c7a40167dee68075f0 | | qos_policy_id | None | | revision_number | 0 | | router_id | None | | status | DOWN | | subnet_id | None | | tags | [] | | updated_at | 2018-04-02T00:44:14Z | +---------------------+--------------------------------------+ Attach this to our host-1 instance. You can now see the floating IP also listed in the openstack server list output. stack@openstack-instance-2:~/devstack$ openstack server add floating ip host-1 172.24.4.5 stack@openstack-instance-2:~/devstack$ openstack server list --name host-1 -f yaml - Flavor: m1.tiny ID: dbda4926-4ca6-40be-b673-d0c811ae43c2 Image: cirros-0.3.5-x86_64-disk Name: host-1 Networks: inside=10.1.1.10, 172.24.4.5 Status: ACTIVE Here you can see the floating ip is mapped to our port-id. stack@openstack-instance-2:~/devstack$ openstack floating ip show 172.24.4.5 +---------------------+--------------------------------------+ | Field | Value | +---------------------+--------------------------------------+ | created_at | 2018-04-02T00:44:14Z | | description | | | fixed_ip_address | 10.1.1.10 | | floating_ip_address | 172.24.4.5 | | floating_network_id | 1fe4e71c-d94e-400c-bcee-8067b621c827 | | id | e2ff37e4-f8f5-4413-98aa-e0df516c1a3b | | name | 172.24.4.5 | | port_id | de7ee5de-e694-4ff3-9763-d7fb86e0038c | | project_id | 9d390c83cc4e46c7a40167dee68075f0 | | qos_policy_id | None | | revision_number | 2 | | router_id | f36a24b0-e4a3-41de-9fdd-73f85df9dbaa | | status | ACTIVE | | subnet_id | None | | tags | [] | | updated_at | 2018-04-02T00:47:14Z | +---------------------+--------------------------------------+ We require one last step to initiate inbound connections to the host. Recall that each ports are assigned with a security group. Since this is an inbound connection, we need to explicitly permit access in security group. Check the Security Group assigned to our port. stack@openstack-instance-2:~/devstack$ openstack port \show de7ee5de-e694-4ff3-9763-d7fb86e0038c -c &apos;security_group_ids&apos; -f yaml security_group_ids: bd41b78c-974c-4854-b808-dec11575964b Let us see the rules which are permitted by this security group. stack@openstack-instance-2:~/devstack$ openstack security group show bd41b78c-974c-4854-b808-dec11575964b -f yaml created_at: &apos;2018-04-01T09:01:20Z&apos; description: Default security group id: bd41b78c-974c-4854-b808-dec11575964b name: default project_id: 9d390c83cc4e46c7a40167dee68075f0 revision_number: 6 rules: &apos;created_at=&apos;&apos;2018-04-01T09:01:20Z&apos;&apos;, direction=&apos;&apos;ingress&apos;&apos;, ethertype=&apos;&apos;IPv4&apos;&apos;, id=&apos;&apos;2ab4f8a5-43ed-4f3e-8c43-cc854bc8feb3&apos;&apos;, remote_group_id=&apos;&apos;bd41b78c-974c-4854-b808-dec11575964b&apos;&apos;, updated_at=&apos;&apos;2018-04-01T09:01:20Z&apos;&apos; created_at=&apos;&apos;2018-04-01T09:01:20Z&apos;&apos;, direction=&apos;&apos;egress&apos;&apos;, ethertype=&apos;&apos;IPv6&apos;&apos;, id=&apos;&apos;5c33d0ac-8ee9-4bd7-951c-dca998931828&apos;&apos;, updated_at=&apos;&apos;2018-04-01T09:01:20Z&apos;&apos; created_at=&apos;&apos;2018-04-01T09:01:20Z&apos;&apos;, direction=&apos;&apos;ingress&apos;&apos;, ethertype=&apos;&apos;IPv6&apos;&apos;, id=&apos;&apos;d7c7a642-485b-482e-8d26-a958aaafa19e&apos;&apos;, remote_group_id=&apos;&apos;bd41b78c-974c-4854-b808-dec11575964b&apos;&apos;, updated_at=&apos;&apos;2018-04-01T09:01:20Z&apos;&apos; created_at=&apos;&apos;2018-04-01T09:01:20Z&apos;&apos;, direction=&apos;&apos;egress&apos;&apos;, ethertype=&apos;&apos;IPv4&apos;&apos;, id=&apos;&apos;f41405df-d0c9-4427-ba11-f0a26b025c3e&apos;&apos;, updated_at=&apos;&apos;2018-04-01T09:01:20Z&apos;&apos;&apos; tags: [] updated_at: &apos;2018-04-02T01:56:25Z&apos; Here you can see 4 rules, two each for IPv4 and IPv6. For egress rules, you can see that there is no remote prefix or group id configured. It means all outbound connections are permitted. For ingress traffic, you can see that the remote_group_id references to self. It means that all ports assigned to the same security group can send inbound traffic unhindered. Let us add more rules to permit ICMP and SSH stack@openstack-instance-2:~/devstack$ openstack security group rule create \ --protocol icmp --ingress --remote-ip 0.0.0.0/0 default +-------------------+--------------------------------------+ | Field | Value | +-------------------+--------------------------------------+ | created_at | 2018-04-02T01:54:12Z | | description | | | direction | ingress | | ether_type | IPv4 | | id | df23fec9-b87a-47ef-8f38-67472de46071 | | name | None | | port_range_max | None | | port_range_min | None | | project_id | 9d390c83cc4e46c7a40167dee68075f0 | | protocol | icmp | | remote_group_id | None | | remote_ip_prefix | 0.0.0.0/0 | | revision_number | 0 | | security_group_id | bd41b78c-974c-4854-b808-dec11575964b | | updated_at | 2018-04-02T01:54:12Z | +-------------------+--------------------------------------+ stack@openstack-instance-2:~/devstack$ openstack security group rule create \ --protocol tcp --dst-port 22 --ingress --remote-ip 0.0.0.0/0 default +-------------------+--------------------------------------+ | Field | Value | +-------------------+--------------------------------------+ | created_at | 2018-04-02T01:56:25Z | | description | | | direction | ingress | | ether_type | IPv4 | | id | adee3f3f-a5a0-497f-a12d-644e64c7015e | | name | None | | port_range_max | 22 | | port_range_min | 22 | | project_id | 9d390c83cc4e46c7a40167dee68075f0 | | protocol | tcp | | remote_group_id | None | | remote_ip_prefix | 0.0.0.0/0 | | revision_number | 0 | | security_group_id | bd41b78c-974c-4854-b808-dec11575964b | | updated_at | 2018-04-02T01:56:25Z | +-------------------+--------------------------------------+ Note that I am using the security group name default as argument instead of security group id. As with most other arguments, we can use either name or the id. We can find the name from the output of previous show command. Now you can see 2 new rules added to the group stack@openstack-instance-2:~/devstack$ openstack security group rule list -c &apos;IP Protocol&apos; -c &apos;IP Range&apos; -c &apos;Port Range&apos; -f yaml - IP Protocol: null IP Range: null Port Range: &apos;&apos; - IP Protocol: null IP Range: null Port Range: &apos;&apos; - IP Protocol: tcp IP Range: 0.0.0.0/0 Port Range: &apos;22:22&apos; - IP Protocol: null IP Range: null Port Range: &apos;&apos; - IP Protocol: icmp IP Range: 0.0.0.0/0 Port Range: &apos;&apos; - IP Protocol: null IP Range: null Port Range: &apos;&apos; Note that in the previous list command output, there were lot of fields. Here I have used -c argument to select the interesting fields. To select multiple columns, we have to repeat this -c argument. Now we can initiate SSH and ICMP connections to this VM host using floating ip address. stack@openstack-instance-2:~/devstack$ ping 172.24.4.5 PING 172.24.4.5 (172.24.4.5) 56(84) bytes of data. 64 bytes from 172.24.4.5: icmp_seq=1 ttl=63 time=0.628 ms 64 bytes from 172.24.4.5: icmp_seq=2 ttl=63 time=0.529 ms ^C --- 172.24.4.5 ping statistics --- 2 packets transmitted, 2 received, 0% packet loss, time 1003ms rtt min/avg/max/mdev = 0.529/0.578/0.628/0.055 ms stack@openstack-instance-2:~/devstack$ ssh cirros@172.24.4.5 cirros@172.24.4.5&apos;s password: cirros-1-1-1-10$ Recall that the hosts were able to ping each other even before we updated the security group. It is because all the ports were assigned to the default security group and hosts on security group can talk to each other by virtue of an implicit rule. Conclusion I have barely scratched the surface of things possible with Openstack. However, this post should give a good idea about the general command structure and operation procedures in Openstack. For further learning, dig around the official documentation (pay attention to openstack version in the docs, there can be major differences between each versions) or setup a lab environment and play around. On the Neutron front, there are a lot of topics to explore such as ML2 network types, virtual switch types, L3 agents etc., Redhat’s official documentation provides a good introduction to many of these components.">
<meta property="og:locale" content="en">
<meta property="og:image" content="/assets/images/2018/04/introduction-to-openstack-networking-for-network-engineers/topology.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Introduction to OpenStack Networking for Network Engineers">
<meta name="twitter:description" content="Introduction This post is a gentle introduction to networking with Openstack using the Neutron module. Being an introduction, we will not focus on setting up OpenStack from scratch. Instead we will familiarize ourselves with core concepts of Neutron and common administrative tasks. We will use the latest release of Openstack, Queens. For ease of setup, we will make use of pre-packaged Devstack environment. Devstack is a set of scripts from official OpenStack community that allows us to quickly build an Openstack instance with latest versions of all modules. It is very useful for testing and training purposes. Neutron Concepts Let us go through the important terms first: Network - A Network is a logical container of entities. To think of it in physical networking terms, it can represent a site, a DC, a campus- or anything else termed as a single network. In AWS terms, a network is similar to a VPC. Note that the definition of a Network is not entirely arbitrary as we may encounter some design choices when deciding CIDR, load balancers, routers, external gateway etc., Subnet - Subnet is similar to a vlan in traditional networking. All hosts in the same Subnet can talk to each other and share the same address space. For beginners, it is possible to confuse a Subnet with Network since both terms are used interchangeably in traditional networking. But keep in mind that one network can contain many subnets. The concept of a Subnet is similar both in OpenStack and AWS. Port - A port is a virtual NIC card which is used by resources to access network. A port is tied to a subnet and assigned with a Security group (introduced below). In AWS terms, it is similar to ENI (Elastic Network Interface) Security Group - Security groups are like port ACL in traditional networking, except that the filtering happens at the hypervisor level. Multiple ports can share the same security group. By default, entities assigned to the same Security Group can talk to each other. It is also similar in scope and function to the Security Group in AWS. Floating IP - This is similar to elastic IP in AWS. These are not tied to any port and can be re-assigned to other ports dynamically. The closest feature in traditional networking would be a static NAT. In AWS terms, it is called Elastic IP. Objective We will create the below topology on Openstack. Hosts host-1 &amp;amp; host-2 will be on same subnet while host-3 will be on another subnet. We will enable reachability between all 3 hosts. Finally, we will also enable bi-directional connectivity to host-1 from internet. Preparing the environment Make home directory for our devstack installation and download the latest copy of DevStack there. I am using Ubuntu 16.04 for my environment. $ sudo mkdir -p /opt/stack &amp;amp;&amp;amp; cd /opt/stack $ sudo git clone https://git.openstack.org/openstack-dev/devstack Switch to devstack folder and create a user account using the pre-built script. The script grants passwordless root privilege to this account. Switch to the stack account to proceed with rest of the steps. $ cd devstack $ sudo bash tools/create-stack-user.sh Switch to stack user and create a config file. Provide your preferred password which will be used for rest of the setup. The local.conf should be present in the root directory of devstack (same location as stack.sh) $ sudo su stack $ vi local.conf [[local|localrc]] ADMIN_PASSWORD=password DATABASE_PASSWORD=$ADMIN_PASSWORD RABBIT_PASSWORD=$ADMIN_PASSWORD SERVICE_PASSWORD=$ADMIN_PASSWORD Run the setup script stack.sh and watch the magic happen. It takes a while since the script installs almost every component of Openstack. ./stack.sh DevStack also provides convenient script to tear down the environment and start from scratch. So once we are done with our testing, we can run unstack.sh to bring the environment back to a blank state. After the installation is complete, source the openrc file to import openstack commands in your searchpath. source openrc Building subnets Before we create new subnets, let us list the set of pre-built subnets that were setup as part of devstack deployment. stack@openstack-instance-2:~/devstack$ openstack network list -f yaml - ID: 1fe4e71c-d94e-400c-bcee-8067b621c827 Name: public Subnets: c0718110-7493-46bf-ba48-720762e47934, fab15575-ae4f-4528-bf0d-ac40d2000484 - ID: 2ebe2084-6dae-40dd-8704-7954944238d7 Name: private Subnets: 244ed014-8b9f-4e4d-ab12-9931ecec4238, 265de598-d881-4d58-a185-1a69be39b2fd The default output format is table. To simplify horizontal scrolling, I have selected yaml output using the -f switch. Create a new network called inside. stack@openstack-instance-2:~/devstack$ openstack network create inside +---------------------------+--------------------------------------+ | Field | Value | +---------------------------+--------------------------------------+ | admin_state_up | UP | | availability_zone_hints | | | availability_zones | | | created_at | 2018-04-01T09:14:41Z | | description | | | dns_domain | None | | id | a0fc23dd-f1a5-4e9b-9d58-ea63b30d076b | | ipv4_address_scope | None | | ipv6_address_scope | None | | is_default | False | | is_vlan_transparent | None | | mtu | 1450 | | name | inside | | port_security_enabled | True | | project_id | 9d390c83cc4e46c7a40167dee68075f0 | | provider:network_type | None | | provider:physical_network | None | | provider:segmentation_id | None | | qos_policy_id | None | | revision_number | 2 | | router:external | Internal | | segments | None | | shared | False | | status | ACTIVE | | subnets | | | tags | | | updated_at | 2018-04-01T09:14:41Z | +---------------------------+--------------------------------------+ Next we will create new subnets. Before that, let us list down the existing subnets for reference. stack@openstack-instance-2:~/devstack$ openstack subnet list -f yaml - ID: 244ed014-8b9f-4e4d-ab12-9931ecec4238 Name: private-subnet Network: 2ebe2084-6dae-40dd-8704-7954944238d7 Subnet: 10.0.0.0/26 - ID: 265de598-d881-4d58-a185-1a69be39b2fd Name: ipv6-private-subnet Network: 2ebe2084-6dae-40dd-8704-7954944238d7 Subnet: fd7b:34b0:9a57::/64 Create a new subnet within the network. We will call it net-01 and assign a subnet range of 10.1.1.0/24 stack@openstack-instance-2:~/devstack$ openstack subnet create net-01 --network inside --subnet-range 10.1.1.0/24 +-------------------+--------------------------------------+ | Field | Value | +-------------------+--------------------------------------+ | allocation_pools | 10.1.1.2-10.1.1.254 | | cidr | 10.1.1.0/24 | | created_at | 2018-04-01T09:20:13Z | | description | | | dns_nameservers | | | enable_dhcp | True | | gateway_ip | 10.1.1.1 | | host_routes | | | id | 0317aa4a-84d3-44df-8781-3f04d558a473 | | ip_version | 4 | | ipv6_address_mode | None | | ipv6_ra_mode | None | | name | net-01 | | network_id | a0fc23dd-f1a5-4e9b-9d58-ea63b30d076b | | project_id | 9d390c83cc4e46c7a40167dee68075f0 | | revision_number | 0 | | segment_id | None | | service_types | | | subnetpool_id | None | | tags | | | updated_at | 2018-04-01T09:20:13Z | +-------------------+--------------------------------------+ As mentioned earlier, the relation between subnet and network is many-to-one. So we can create another subnet net-02 within the same inside network. stack@openstack-instance-2:~/devstack$ openstack subnet create net-02 --network inside --subnet-range 10.1.2.0/24 +-------------------+--------------------------------------+ | Field | Value | +-------------------+--------------------------------------+ | allocation_pools | 10.1.2.2-10.1.2.254 | | cidr | 10.1.2.0/24 | | created_at | 2018-04-01T09:21:07Z | | description | | | dns_nameservers | | | enable_dhcp | True | | gateway_ip | 10.1.2.1 | | host_routes | | | id | 6e5f2220-29da-4679-962f-22934f2c3d49 | | ip_version | 4 | | ipv6_address_mode | None | | ipv6_ra_mode | None | | name | net-02 | | network_id | a0fc23dd-f1a5-4e9b-9d58-ea63b30d076b | | project_id | 9d390c83cc4e46c7a40167dee68075f0 | | revision_number | 0 | | segment_id | None | | service_types | | | subnetpool_id | None | | tags | | | updated_at | 2018-04-01T09:21:07Z | +-------------------+--------------------------------------+ Creating nova compute instances We need to know the image names available before creating an instance. List the images available. stack@openstack-instance-2:~/devstack$ openstack image list -f yaml - ID: 2a5fbb6b-b694-4f76-ac19-4af358d1c7e8 Name: cirros-0.3.5-x86_64-disk Status: active Cirros is a tiny image available as part of devstack, useful for testing purpose. Let us create two instances under inside network running cirros image. stack@openstack-instance-2:~/devstack$ openstack server create / --flavor m1.tiny --image cirros-0.3.5-x86_64-disk --network inside host --min 2 --max 2 +-----------------------------+-----------------------------------------------------------------+ | Field | Value | +-----------------------------+-----------------------------------------------------------------+ | OS-DCF:diskConfig | MANUAL | | OS-EXT-AZ:availability_zone | | | OS-EXT-STS:power_state | NOSTATE | | OS-EXT-STS:task_state | scheduling | | OS-EXT-STS:vm_state | building | | OS-SRV-USG:launched_at | None | | OS-SRV-USG:terminated_at | None | | accessIPv4 | | | accessIPv6 | | | addresses | | | adminPass | odJy58yPdHnz | | config_drive | | | created | 2018-04-01T09:25:55Z | | flavor | m1.tiny (1) | | hostId | | | id | dbda4926-4ca6-40be-b673-d0c811ae43c2 | | image | cirros-0.3.5-x86_64-disk (2a5fbb6b-b694-4f76-ac19-4af358d1c7e8) | | key_name | None | | name | host-1 | | progress | 0 | | project_id | 9d390c83cc4e46c7a40167dee68075f0 | | properties | | | security_groups | name=&apos;default&apos; | | status | BUILD | | updated | 2018-04-01T09:25:55Z | | user_id | dfd4e794f59f48549016de1263c30dbb | | volumes_attached | | +-----------------------------+-----------------------------------------------------------------+ Either min or max parameter is necessary. or else server build fails miserably with no clue as to what went wrong. Note that in the above command we specified only the network and not subnet. But this network has two subnets. So let us see which subnet is chosen to run the nova compute instances. stack@openstack-instance-2:~/devstack$ openstack server list -f yaml - Flavor: m1.tiny ID: 5ea3d968-aa29-4911-b658-e0b6498b09f4 Image: cirros-0.3.5-x86_64-disk Name: host-2 Networks: inside=10.1.1.9 Status: ACTIVE - Flavor: m1.tiny ID: dbda4926-4ca6-40be-b673-d0c811ae43c2 Image: cirros-0.3.5-x86_64-disk Name: host-1 Networks: inside=10.1.1.10 Status: ACTIVE It turns out the first subnet net-01 we created is being used. But if we want to specify net-02 for instance creation, it is more tricky. We need to create a port in that subnet and attach its nic during instance creation. stack@openstack-instance-2:~/devstack$ openstack port create \ --network a0fc23dd-f1a5-4e9b-9d58-ea63b30d076b --fixed-ip subnet=6e5f2220-29da-4679-962f-22934f2c3d49 if-host-02 +-----------------------+-------------------------------------------------------------------------+ | Field | Value | +-----------------------+-------------------------------------------------------------------------+ | admin_state_up | UP | | allowed_address_pairs | | | binding_host_id | None | | binding_profile | None | | binding_vif_details | None | | binding_vif_type | None | | binding_vnic_type | normal | | created_at | 2018-04-01T09:32:31Z | | data_plane_status | None | | description | | | device_id | | | device_owner | | | dns_assignment | None | | dns_domain | None | | dns_name | None | | extra_dhcp_opts | | | fixed_ips | ip_address=&apos;10.1.2.5&apos;, subnet_id=&apos;6e5f2220-29da-4679-962f-22934f2c3d49&apos; | | id | 2b9635bf-8f93-4663-9c6d-f40f0492195c | | ip_address | None | | mac_address | fa:16:3e:40:08:73 | | name | if-host-02 | | network_id | a0fc23dd-f1a5-4e9b-9d58-ea63b30d076b | | option_name | None | | option_value | None | | port_security_enabled | True | | project_id | 9d390c83cc4e46c7a40167dee68075f0 | | qos_policy_id | None | | revision_number | 6 | | security_group_ids | bd41b78c-974c-4854-b808-dec11575964b | | status | DOWN | | subnet_id | None | | tags | | | trunk_details | None | | updated_at | 2018-04-01T09:32:31Z | +-----------------------+-------------------------------------------------------------------------+ Now create an instance in this subnet. Use the port id from above output to specify the nic. stack@openstack-instance-2:~/devstack$ openstack server create --flavor m1.tiny \ --image cirros-0.3.5-x86_64-disk --nic port-id=2b9635bf-8f93-4663-9c6d-f40f0492195c host-3 --max 1 +-----------------------------+-----------------------------------------------------------------+ | Field | Value | +-----------------------------+-----------------------------------------------------------------+ | OS-DCF:diskConfig | MANUAL | | OS-EXT-AZ:availability_zone | | | OS-EXT-STS:power_state | NOSTATE | | OS-EXT-STS:task_state | scheduling | | OS-EXT-STS:vm_state | building | | OS-SRV-USG:launched_at | None | | OS-SRV-USG:terminated_at | None | | accessIPv4 | | | accessIPv6 | | | addresses | | | adminPass | hnN294KgUTrY | | config_drive | | | created | 2018-04-01T09:52:23Z | | flavor | m1.tiny (1) | | hostId | | | id | 376c3d59-f74c-4b3b-a4c7-5b9fb9d3eef7 | | image | cirros-0.3.5-x86_64-disk (2a5fbb6b-b694-4f76-ac19-4af358d1c7e8) | | key_name | None | | name | host-3 | | progress | 0 | | project_id | 9d390c83cc4e46c7a40167dee68075f0 | | properties | | | security_groups | name=&apos;default&apos; | | status | BUILD | | updated | 2018-04-01T09:52:23Z | | user_id | dfd4e794f59f48549016de1263c30dbb | | volumes_attached | | +-----------------------------+-----------------------------------------------------------------+ Before we move on to next section, tet us check the server instances we have created so far. stack@openstack-instance-2:~/devstack$ openstack server list -f yaml - Flavor: m1.tiny ID: 376c3d59-f74c-4b3b-a4c7-5b9fb9d3eef7 Image: cirros-0.3.5-x86_64-disk Name: host-3 Networks: inside=10.1.2.5 Status: ACTIVE - Flavor: m1.tiny ID: 5ea3d968-aa29-4911-b658-e0b6498b09f4 Image: cirros-0.3.5-x86_64-disk Name: host-2 Networks: inside=10.1.1.9 Status: ACTIVE - Flavor: m1.tiny ID: dbda4926-4ca6-40be-b673-d0c811ae43c2 Image: cirros-0.3.5-x86_64-disk Name: host-1 Networks: inside=10.1.1.10 Status: ACTIVE Neutron networking between hosts Let us see the subnet membership of each ports. stack@openstack-instance-2:~/devstack$ openstack port list -f yaml --fixed-ip subnet=net-01 - Fixed IP Addresses: &apos;ip_address=&apos;&apos;10.1.1.2&apos;&apos;, subnet_id=&apos;&apos;0317aa4a-84d3-44df-8781-3f04d558a473&apos;&apos; ip_address=&apos;&apos;10.1.2.2&apos;&apos;, subnet_id=&apos;&apos;6e5f2220-29da-4679-962f-22934f2c3d49&apos;&apos;&apos; ID: 6764de9f-deec-494b-a9b4-0903bfbfefea MAC Address: fa:16:3e:8f:47:41 Name: &apos;&apos; Status: ACTIVE - Fixed IP Addresses: ip_address=&apos;10.1.1.9&apos;, subnet_id=&apos;0317aa4a-84d3-44df-8781-3f04d558a473&apos; ID: ab283b4a-5738-48c9-8a53-343a1e5c795d MAC Address: fa:16:3e:9d:b6:7f Name: &apos;&apos; Status: ACTIVE - Fixed IP Addresses: ip_address=&apos;10.1.1.10&apos;, subnet_id=&apos;0317aa4a-84d3-44df-8781-3f04d558a473&apos; ID: de7ee5de-e694-4ff3-9763-d7fb86e0038c MAC Address: fa:16:3e:7a:ce:84 Name: &apos;&apos; Status: ACTIVE stack@openstack-instance-2:~/devstack$ openstack port list -f yaml --fixed-ip subnet=net-02 - Fixed IP Addresses: ip_address=&apos;10.1.2.5&apos;, subnet_id=&apos;6e5f2220-29da-4679-962f-22934f2c3d49&apos; ID: 2b9635bf-8f93-4663-9c6d-f40f0492195c MAC Address: fa:16:3e:40:08:73 Name: if-host-02 Status: ACTIVE - Fixed IP Addresses: &apos;ip_address=&apos;&apos;10.1.1.2&apos;&apos;, subnet_id=&apos;&apos;0317aa4a-84d3-44df-8781-3f04d558a473&apos;&apos; ip_address=&apos;&apos;10.1.2.2&apos;&apos;, subnet_id=&apos;&apos;6e5f2220-29da-4679-962f-22934f2c3d49&apos;&apos;&apos; ID: 6764de9f-deec-494b-a9b4-0903bfbfefea MAC Address: fa:16:3e:8f:47:41 Name: &apos;&apos; Status: ACTIVE We can see that one port appears in both the subnets (MAC address: fa:16:3e:8f:47:41). This is the default DNS server of the network and gets attached to the subnet automatically unless we explicitly specify otherwise. To test connectivity we need to console in to the hosts. We will use virsh to console in to the instances. First let us list the hosts. stack@openstack-instance-2:~/devstack$ sudo virsh list Id Name State ---------------------------------------------------- 1 instance-00000001 running 2 instance-00000002 running 3 instance-00000003 running Console to the first instance host-1. stack@openstack-instance-2:~/devstack$ sudo virsh console 1 Connected to domain instance-00000001 Escape character is ^] login as &apos;cirros&apos; user. default password: &apos;cubswin:)&apos;. use &apos;sudo&apos; for root. cirros login: cirros Password: $ ip add | grep &apos;inet.*10&apos; inet 10.1.1.10/24 brd 10.1.1.255 scope global eth0 $ sudo hostname cirros-1-1-1-10 $ export PS1=&quot;\h$ &quot; We will see that this host can talk to other host host-2 within the same subnet. cirros-1-1-1-10$ ping 10.1.1.9 PING 10.1.1.9 (10.1.1.9): 56 data bytes 64 bytes from 10.1.1.9: seq=0 ttl=64 time=4.409 ms 64 bytes from 10.1.1.9: seq=1 ttl=64 time=1.070 ms 64 bytes from 10.1.1.9: seq=2 ttl=64 time=1.437 ms --- 10.1.1.9 ping statistics --- 3 packets transmitted, 3 packets received, 0% packet loss round-trip min/avg/max = 1.070/2.305/4.409 ms But it cannot reach host-3 which is a different subnet (net-02) cirros-1-1-1-10$ ping 10.1.2.5 PING 10.1.2.5 (10.1.2.5): 56 data bytes --- 10.1.2.5 ping statistics --- 3 packets transmitted, 0 packets received, 100% packet loss Likewise, the host cannot reach external network such as internet. cirros-1-1-1-10$ ping 8.8.8.8 PING 8.8.8.8 (8.8.8.8): 56 data bytes --- 8.8.8.8 ping statistics --- 3 packets transmitted, 0 packets received, 100% packet loss Like in any tradional network, we need a router to allow traffic between different subnets. OpenStack Neutron provides a software defined router which can attach to multiple subnets and provide the same functionality. Let us go ahead and create a router. stack@openstack-instance-2:~/devstack$ openstack router create demo_router +-------------------------+--------------------------------------+ | Field | Value | +-------------------------+--------------------------------------+ | admin_state_up | UP | | availability_zone_hints | | | availability_zones | | | created_at | 2018-04-02T00:14:29Z | | description | | | distributed | False | | external_gateway_info | None | | flavor_id | None | | ha | False | | id | f36a24b0-e4a3-41de-9fdd-73f85df9dbaa | | name | demo_router | | project_id | 9d390c83cc4e46c7a40167dee68075f0 | | revision_number | 1 | | routes | | | status | ACTIVE | | tags | | | updated_at | 2018-04-02T00:14:29Z | +-------------------------+--------------------------------------+ List the routers visible to validate the result. You can see an existing pre-built router and the one we created just now. stack@openstack-instance-2:~/devstack$ openstack router list -f yaml - Distributed: false HA: false ID: 58cc905f-4c8b-4641-ba92-a1a491d818ab Name: router1 Project: 9d390c83cc4e46c7a40167dee68075f0 State: UP Status: ACTIVE - Distributed: false HA: false ID: f36a24b0-e4a3-41de-9fdd-73f85df9dbaa Name: demo_router Project: 9d390c83cc4e46c7a40167dee68075f0 State: UP Status: ACTIVE Now we will attach our subnets to the router. stack@openstack-instance-2:~/devstack$ openstack router add subnet demo_router net-01 stack@openstack-instance-2:~/devstack$ openstack router add subnet demo_router net-02 You can see one new port from each subnet getting attached to the router. stack@openstack-instance-2:~/devstack$ openstack port list -f yaml --router demo_router - Fixed IP Addresses: ip_address=&apos;10.1.1.1&apos;, subnet_id=&apos;0317aa4a-84d3-44df-8781-3f04d558a473&apos; ID: 468ff846-fb1d-4ef2-85b0-3957885c59a8 MAC Address: fa:16:3e:b1:31:fa Name: &apos;&apos; Status: ACTIVE - Fixed IP Addresses: ip_address=&apos;10.1.2.1&apos;, subnet_id=&apos;6e5f2220-29da-4679-962f-22934f2c3d49&apos; ID: ee15064b-26f2-46ae-bc09-02db440edd3b MAC Address: fa:16:3e:7c:62:28 Name: &apos;&apos; Status: ACTIVE To reduce the output I have filtered the port list with an argument –router . Most list commands have ability to filter output like this. Use the interactive help menu to figure out the filter options. Let us try to reach the host on the other network. cirros-1-1-1-10$ ping 10.1.2.5 PING 10.1.2.5 (10.1.2.5): 56 data bytes 64 bytes from 10.1.2.5: seq=0 ttl=63 time=4.141 ms 64 bytes from 10.1.2.5: seq=1 ttl=63 time=1.499 ms --- 10.1.2.5 ping statistics --- 2 packets transmitted, 2 packets received, 0% packet loss round-trip min/avg/max = 1.499/2.820/4.141 ms Success! As expected, the host is one hop away. cirros-1-1-1-10$ traceroute 10.1.2.5 traceroute to 10.1.2.5 (10.1.2.5), 30 hops max, 46 byte packets 1 host-10-1-1-1.openstacklocal (10.1.1.1) 2.217 ms 0.360 ms 0.301 ms 2 host-10-1-2-5.openstacklocal (10.1.2.5) 1.568 ms 1.155 ms 0.803 ms But the outside world connection is not ready yet. For that we need to attach it to a public network. Recall that there was a pre-built public network as part of devstack setup. We will use this network to communicate to outside world. stack@openstack-instance-2:~/devstack$ openstack router set --external-gateway public demo_router stack@openstack-instance-2:~/devstack$ openstack router show demo_router -f yaml admin_state_up: UP availability_zone_hints: &apos;&apos; availability_zones: nova created_at: &apos;2018-04-02T00:14:29Z&apos; description: &apos;&apos; distributed: false external_gateway_info: &apos;{&quot;network_id&quot;: &quot;1fe4e71c-d94e-400c-bcee-8067b621c827&quot;, &quot;enable_snat&quot;: true, &quot;external_fixed_ips&quot;: [{&quot;subnet_id&quot;: &quot;c0718110-7493-46bf-ba48-720762e47934&quot;, &quot;ip_address&quot;: &quot;172.24.4.3&quot;}, {&quot;subnet_id&quot;: &quot;fab15575-ae4f-4528-bf0d-ac40d2000484&quot;, &quot;ip_address&quot;: &quot;2001:db8::6&quot;}]}&apos; flavor_id: null ha: false id: f36a24b0-e4a3-41de-9fdd-73f85df9dbaa interfaces_info: &apos;[{&quot;subnet_id&quot;: &quot;0317aa4a-84d3-44df-8781-3f04d558a473&quot;, &quot;ip_address&quot;: &quot;10.1.1.1&quot;, &quot;port_id&quot;: &quot;468ff846-fb1d-4ef2-85b0-3957885c59a8&quot;}, {&quot;subnet_id&quot;: &quot;6e5f2220-29da-4679-962f-22934f2c3d49&quot;, &quot;ip_address&quot;: &quot;10.1.2.1&quot;, &quot;port_id&quot;: &quot;ee15064b-26f2-46ae-bc09-02db440edd3b&quot;}]&apos; name: demo_router project_id: 9d390c83cc4e46c7a40167dee68075f0 revision_number: 5 routes: &apos;&apos; status: ACTIVE tags: &apos;&apos; updated_at: &apos;2018-04-02T00:32:54Z&apos; The show command is similar to list command, but can show more detailed information about a single resource. As expected, it requires an additional unique identifier argument to identify the resource which we want to display. See that there is a new external_gateway_info section. Now let us try to reach the internet. stack@openstack-instance-2:~/devstack$ sudo virsh console 1 Connected to domain instance-00000001 Escape character is ^] cirros-1-1-1-10$ ping 8.8.8.8 PING 8.8.8.8 (8.8.8.8): 56 data bytes 64 bytes from 8.8.8.8: seq=0 ttl=50 time=7.129 ms 64 bytes from 8.8.8.8: seq=1 ttl=51 time=1.483 ms 64 bytes from 8.8.8.8: seq=2 ttl=51 time=1.137 ms  --- 8.8.8.8 ping statistics --- 3 packets transmitted, 3 packets received, 0% packet loss round-trip min/avg/max = 1.137/3.249/7.129 ms Success! To see how this traffic reaches out to internet, we will do tcpdump on the hypervisor. stack@openstack-instance-2:~/ sudo tcpdump &apos;host 8.8.8.8&apos; -X tcpdump: verbose output suppressed, use -v or -vv for full protocol decode listening on br-ex, link-type EN10MB (Ethernet), capture size 262144 bytes 00:37:14.019550 IP 172.24.4.3 &amp;gt; google-public-dns-a.google.com: ICMP echo request, id 49153, seq 0, length 64 0x0000: 4500 0054 0979 4000 3f01 7205 ac18 0403 E..T.y@.?.r..... 0x0010: 0808 0808 0800 5076 c001 0000 73cd 73ba ......Pv....s.s. 0x0020: 0000 0000 0000 0000 0000 0000 0000 0000 ................ 0x0030: 0000 0000 0000 0000 0000 0000 0000 0000 ................ 0x0040: 0000 0000 0000 0000 0000 0000 0000 0000 ................ 0x0050: 0000 0000 .... 00:37:14.020493 IP google-public-dns-a.google.com &amp;gt; 172.24.4.3: ICMP echo reply, id 49153, seq 0, length 64 0x0000: 4500 0054 0000 0000 3401 c67e 0808 0808 E..T....4..~.... 0x0010: ac18 0403 0000 5876 c001 0000 73cd 73ba ......Xv....s.s. 0x0020: 0000 0000 0000 0000 0000 0000 0000 0000 ................ 0x0030: 0000 0000 0000 0000 0000 0000 0000 0000 ................ 0x0040: 0000 0000 0000 0000 0000 0000 0000 0000 ................ 0x0050: 0000 0000 The traffic from the host is being source NAT by the router to go out to the internet (recall from the earlier output that 172.24.4.3 belongs to the external gateway of the router). In traditional networking term this is called NAT overloading. This can provide only outbound connectivity for the host. In order to provide inbound connectivity to the host, we need to create a floating ip. This is similar to elastic IP in AWS or staic NAT in traditional networking. stack@openstack-instance-2:~/devstack$ openstack floating ip create public +---------------------+--------------------------------------+ | Field | Value | +---------------------+--------------------------------------+ | created_at | 2018-04-02T00:44:14Z | | description | | | fixed_ip_address | None | | floating_ip_address | 172.24.4.5 | | floating_network_id | 1fe4e71c-d94e-400c-bcee-8067b621c827 | | id | e2ff37e4-f8f5-4413-98aa-e0df516c1a3b | | name | 172.24.4.5 | | port_id | None | | project_id | 9d390c83cc4e46c7a40167dee68075f0 | | qos_policy_id | None | | revision_number | 0 | | router_id | None | | status | DOWN | | subnet_id | None | | tags | [] | | updated_at | 2018-04-02T00:44:14Z | +---------------------+--------------------------------------+ Attach this to our host-1 instance. You can now see the floating IP also listed in the openstack server list output. stack@openstack-instance-2:~/devstack$ openstack server add floating ip host-1 172.24.4.5 stack@openstack-instance-2:~/devstack$ openstack server list --name host-1 -f yaml - Flavor: m1.tiny ID: dbda4926-4ca6-40be-b673-d0c811ae43c2 Image: cirros-0.3.5-x86_64-disk Name: host-1 Networks: inside=10.1.1.10, 172.24.4.5 Status: ACTIVE Here you can see the floating ip is mapped to our port-id. stack@openstack-instance-2:~/devstack$ openstack floating ip show 172.24.4.5 +---------------------+--------------------------------------+ | Field | Value | +---------------------+--------------------------------------+ | created_at | 2018-04-02T00:44:14Z | | description | | | fixed_ip_address | 10.1.1.10 | | floating_ip_address | 172.24.4.5 | | floating_network_id | 1fe4e71c-d94e-400c-bcee-8067b621c827 | | id | e2ff37e4-f8f5-4413-98aa-e0df516c1a3b | | name | 172.24.4.5 | | port_id | de7ee5de-e694-4ff3-9763-d7fb86e0038c | | project_id | 9d390c83cc4e46c7a40167dee68075f0 | | qos_policy_id | None | | revision_number | 2 | | router_id | f36a24b0-e4a3-41de-9fdd-73f85df9dbaa | | status | ACTIVE | | subnet_id | None | | tags | [] | | updated_at | 2018-04-02T00:47:14Z | +---------------------+--------------------------------------+ We require one last step to initiate inbound connections to the host. Recall that each ports are assigned with a security group. Since this is an inbound connection, we need to explicitly permit access in security group. Check the Security Group assigned to our port. stack@openstack-instance-2:~/devstack$ openstack port \show de7ee5de-e694-4ff3-9763-d7fb86e0038c -c &apos;security_group_ids&apos; -f yaml security_group_ids: bd41b78c-974c-4854-b808-dec11575964b Let us see the rules which are permitted by this security group. stack@openstack-instance-2:~/devstack$ openstack security group show bd41b78c-974c-4854-b808-dec11575964b -f yaml created_at: &apos;2018-04-01T09:01:20Z&apos; description: Default security group id: bd41b78c-974c-4854-b808-dec11575964b name: default project_id: 9d390c83cc4e46c7a40167dee68075f0 revision_number: 6 rules: &apos;created_at=&apos;&apos;2018-04-01T09:01:20Z&apos;&apos;, direction=&apos;&apos;ingress&apos;&apos;, ethertype=&apos;&apos;IPv4&apos;&apos;, id=&apos;&apos;2ab4f8a5-43ed-4f3e-8c43-cc854bc8feb3&apos;&apos;, remote_group_id=&apos;&apos;bd41b78c-974c-4854-b808-dec11575964b&apos;&apos;, updated_at=&apos;&apos;2018-04-01T09:01:20Z&apos;&apos; created_at=&apos;&apos;2018-04-01T09:01:20Z&apos;&apos;, direction=&apos;&apos;egress&apos;&apos;, ethertype=&apos;&apos;IPv6&apos;&apos;, id=&apos;&apos;5c33d0ac-8ee9-4bd7-951c-dca998931828&apos;&apos;, updated_at=&apos;&apos;2018-04-01T09:01:20Z&apos;&apos; created_at=&apos;&apos;2018-04-01T09:01:20Z&apos;&apos;, direction=&apos;&apos;ingress&apos;&apos;, ethertype=&apos;&apos;IPv6&apos;&apos;, id=&apos;&apos;d7c7a642-485b-482e-8d26-a958aaafa19e&apos;&apos;, remote_group_id=&apos;&apos;bd41b78c-974c-4854-b808-dec11575964b&apos;&apos;, updated_at=&apos;&apos;2018-04-01T09:01:20Z&apos;&apos; created_at=&apos;&apos;2018-04-01T09:01:20Z&apos;&apos;, direction=&apos;&apos;egress&apos;&apos;, ethertype=&apos;&apos;IPv4&apos;&apos;, id=&apos;&apos;f41405df-d0c9-4427-ba11-f0a26b025c3e&apos;&apos;, updated_at=&apos;&apos;2018-04-01T09:01:20Z&apos;&apos;&apos; tags: [] updated_at: &apos;2018-04-02T01:56:25Z&apos; Here you can see 4 rules, two each for IPv4 and IPv6. For egress rules, you can see that there is no remote prefix or group id configured. It means all outbound connections are permitted. For ingress traffic, you can see that the remote_group_id references to self. It means that all ports assigned to the same security group can send inbound traffic unhindered. Let us add more rules to permit ICMP and SSH stack@openstack-instance-2:~/devstack$ openstack security group rule create \ --protocol icmp --ingress --remote-ip 0.0.0.0/0 default +-------------------+--------------------------------------+ | Field | Value | +-------------------+--------------------------------------+ | created_at | 2018-04-02T01:54:12Z | | description | | | direction | ingress | | ether_type | IPv4 | | id | df23fec9-b87a-47ef-8f38-67472de46071 | | name | None | | port_range_max | None | | port_range_min | None | | project_id | 9d390c83cc4e46c7a40167dee68075f0 | | protocol | icmp | | remote_group_id | None | | remote_ip_prefix | 0.0.0.0/0 | | revision_number | 0 | | security_group_id | bd41b78c-974c-4854-b808-dec11575964b | | updated_at | 2018-04-02T01:54:12Z | +-------------------+--------------------------------------+ stack@openstack-instance-2:~/devstack$ openstack security group rule create \ --protocol tcp --dst-port 22 --ingress --remote-ip 0.0.0.0/0 default +-------------------+--------------------------------------+ | Field | Value | +-------------------+--------------------------------------+ | created_at | 2018-04-02T01:56:25Z | | description | | | direction | ingress | | ether_type | IPv4 | | id | adee3f3f-a5a0-497f-a12d-644e64c7015e | | name | None | | port_range_max | 22 | | port_range_min | 22 | | project_id | 9d390c83cc4e46c7a40167dee68075f0 | | protocol | tcp | | remote_group_id | None | | remote_ip_prefix | 0.0.0.0/0 | | revision_number | 0 | | security_group_id | bd41b78c-974c-4854-b808-dec11575964b | | updated_at | 2018-04-02T01:56:25Z | +-------------------+--------------------------------------+ Note that I am using the security group name default as argument instead of security group id. As with most other arguments, we can use either name or the id. We can find the name from the output of previous show command. Now you can see 2 new rules added to the group stack@openstack-instance-2:~/devstack$ openstack security group rule list -c &apos;IP Protocol&apos; -c &apos;IP Range&apos; -c &apos;Port Range&apos; -f yaml - IP Protocol: null IP Range: null Port Range: &apos;&apos; - IP Protocol: null IP Range: null Port Range: &apos;&apos; - IP Protocol: tcp IP Range: 0.0.0.0/0 Port Range: &apos;22:22&apos; - IP Protocol: null IP Range: null Port Range: &apos;&apos; - IP Protocol: icmp IP Range: 0.0.0.0/0 Port Range: &apos;&apos; - IP Protocol: null IP Range: null Port Range: &apos;&apos; Note that in the previous list command output, there were lot of fields. Here I have used -c argument to select the interesting fields. To select multiple columns, we have to repeat this -c argument. Now we can initiate SSH and ICMP connections to this VM host using floating ip address. stack@openstack-instance-2:~/devstack$ ping 172.24.4.5 PING 172.24.4.5 (172.24.4.5) 56(84) bytes of data. 64 bytes from 172.24.4.5: icmp_seq=1 ttl=63 time=0.628 ms 64 bytes from 172.24.4.5: icmp_seq=2 ttl=63 time=0.529 ms ^C --- 172.24.4.5 ping statistics --- 2 packets transmitted, 2 received, 0% packet loss, time 1003ms rtt min/avg/max/mdev = 0.529/0.578/0.628/0.055 ms stack@openstack-instance-2:~/devstack$ ssh cirros@172.24.4.5 cirros@172.24.4.5&apos;s password: cirros-1-1-1-10$ Recall that the hosts were able to ping each other even before we updated the security group. It is because all the ports were assigned to the default security group and hosts on security group can talk to each other by virtue of an implicit rule. Conclusion I have barely scratched the surface of things possible with Openstack. However, this post should give a good idea about the general command structure and operation procedures in Openstack. For further learning, dig around the official documentation (pay attention to openstack version in the docs, there can be major differences between each versions) or setup a lab environment and play around. On the Neutron front, there are a lot of topics to explore such as ML2 network types, virtual switch types, L3 agents etc., Redhat’s official documentation provides a good introduction to many of these components.">
<meta name="twitter:image" content="/assets/images/2018/04/introduction-to-openstack-networking-for-network-engineers/topology.png">


<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://localhost:4000/"/>





  <title>Introduction to OpenStack Networking for Network Engineers</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-108447382-1', 'auto');
  ga('send', 'pageview');
</script>













</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Ephemeral Electrons</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">A thought, a code, an ephemeral dance of electrons</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            Sitemap
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

<div id="posts" class="posts-expand">
  
  

  

  
  
  

  <article class="post post-type- " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://localhost:4000/networking/2018/03/22/2018-03-22-introduction-to-openstack-networking-for-network-engineers/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tamizh">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/assets/images/confused-monkey.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ephemeral Electrons">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
          
          
            Introduction to OpenStack Networking for Network Engineers
          
        </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-22T12:00:00+08:00">
                2018-03-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/category/#/Networking" itemprop="url" rel="index">
                    <span itemprop="name">Networking</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          
            
          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="introduction">Introduction</h2>

<p>This post is a gentle introduction to networking with Openstack using the Neutron module. Being an introduction, we will not focus on setting up OpenStack from scratch. Instead we will familiarize ourselves with core concepts of Neutron and common administrative tasks. We will use the latest release of Openstack, <strong>Queens</strong>.</p>

<p>For ease of setup, we will make use of pre-packaged Devstack environment. Devstack is a set of scripts from official OpenStack community that allows us to quickly build an Openstack instance with latest versions of all modules. It is very useful for testing and training purposes.</p>

<h2 id="neutron-concepts">Neutron Concepts</h2>
<p>Let us go through the important terms first:</p>

<ol>
  <li>
    <p><strong>Network</strong> - A Network is a logical container of entities. To think of it in physical networking terms, it can represent a site, a DC, a campus- or anything else termed as a single network. In AWS terms, a network is similar to a VPC. Note that the definition of a Network is not entirely arbitrary as we may encounter some design choices when deciding CIDR, load balancers, routers, external gateway etc.,</p>
  </li>
  <li>
    <p><strong>Subnet</strong> - Subnet is similar to a vlan in traditional networking. All hosts in the same Subnet can talk to each other and share the same address space. For beginners, it is possible to confuse a Subnet with Network since both terms are used interchangeably in traditional networking. But keep in mind that one network can contain many subnets. The concept of a Subnet is similar both in OpenStack and AWS.</p>
  </li>
  <li>
    <p><strong>Port</strong> - A port is a virtual NIC card which is used by resources to access network. A port is tied to a subnet and assigned with a Security group (introduced below). In AWS terms, it is similar to ENI (Elastic Network Interface)</p>
  </li>
  <li>
    <p><strong>Security Group</strong> - Security groups are like port ACL in traditional networking, except that the filtering happens at the hypervisor level. Multiple ports can share the same security group. By default, entities assigned to the same Security Group can talk to each other. It is also similar in scope and function to the Security Group in AWS.</p>
  </li>
  <li>
    <p><strong>Floating IP</strong> - This is similar to elastic IP in AWS. These are not tied to any port and can be re-assigned to other ports dynamically. The closest feature in traditional networking would be a static NAT. In AWS terms, it is called Elastic IP.</p>
  </li>
</ol>

<h2 id="objective">Objective</h2>

<p>We will create the below topology on Openstack. Hosts <code class="highlighter-rouge">host-1</code> &amp; <code class="highlighter-rouge">host-2</code> will be on same subnet while <code class="highlighter-rouge">host-3</code> will be on another subnet. We will enable reachability between all 3 hosts. Finally, we will also enable bi-directional connectivity to <code class="highlighter-rouge">host-1</code> from internet.</p>

<p><img src="/assets/images/2018/04/introduction-to-openstack-networking-for-network-engineers/topology.png" alt="topology" /></p>

<h2 id="preparing-the-environment">Preparing the environment</h2>

<p>Make home directory for our devstack installation and download the latest copy of DevStack there. I am using Ubuntu 16.04 for my environment.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo mkdir -p /opt/stack &amp;&amp; cd /opt/stack
$ sudo git clone https://git.openstack.org/openstack-dev/devstack

</code></pre>
</div>

<p>Switch to devstack folder and create a user account using the pre-built script. The script grants passwordless root privilege to this account. Switch to the stack account to proceed with rest of the steps.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ cd devstack
$ sudo bash tools/create-stack-user.sh
</code></pre>
</div>

<p>Switch to <code class="highlighter-rouge">stack</code> user and create a config file. Provide your preferred password which will be used for rest of the setup. The local.conf should be present in the root directory of devstack (same location as stack.sh)</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo su stack
$ vi local.conf
[[local|localrc]]
ADMIN_PASSWORD=password
DATABASE_PASSWORD=$ADMIN_PASSWORD
RABBIT_PASSWORD=$ADMIN_PASSWORD
SERVICE_PASSWORD=$ADMIN_PASSWORD
</code></pre>
</div>

<p>Run the setup script <code class="highlighter-rouge">stack.sh</code> and watch the magic happen. It takes a while since the script installs almost every component of Openstack.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>./stack.sh
</code></pre>
</div>

<blockquote>
  <p>DevStack also provides convenient script to tear down the environment and start from scratch. So once we are done with our testing, we can run <code class="highlighter-rouge">unstack.sh</code> to bring the environment back to a blank state.</p>
</blockquote>

<p>After the installation is complete, source the openrc file to import openstack commands in your searchpath.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>source openrc
</code></pre>
</div>

<h2 id="building-subnets">Building subnets</h2>

<p>Before we create new subnets, let us list the set of pre-built subnets that were setup as part of devstack deployment.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  stack@openstack-instance-2:~/devstack$ openstack network list -f yaml
  - ID: 1fe4e71c-d94e-400c-bcee-8067b621c827
    Name: public
    Subnets: c0718110-7493-46bf-ba48-720762e47934, fab15575-ae4f-4528-bf0d-ac40d2000484
  - ID: 2ebe2084-6dae-40dd-8704-7954944238d7
    Name: private
    Subnets: 244ed014-8b9f-4e4d-ab12-9931ecec4238, 265de598-d881-4d58-a185-1a69be39b2fd
</code></pre>
</div>

<blockquote>
  <p>The default output format is table. To simplify horizontal scrolling, I have selected yaml output using the -f switch.</p>
</blockquote>

<p>Create a new network called <code class="highlighter-rouge">inside</code>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  stack@openstack-instance-2:~/devstack$ openstack network create inside
  +---------------------------+--------------------------------------+
  | Field                     | Value                                |
  +---------------------------+--------------------------------------+
  | admin_state_up            | UP                                   |
  | availability_zone_hints   |                                      |
  | availability_zones        |                                      |
  | created_at                | 2018-04-01T09:14:41Z                 |
  | description               |                                      |
  | dns_domain                | None                                 |
  | id                        | a0fc23dd-f1a5-4e9b-9d58-ea63b30d076b |
  | ipv4_address_scope        | None                                 |
  | ipv6_address_scope        | None                                 |
  | is_default                | False                                |
  | is_vlan_transparent       | None                                 |
  | mtu                       | 1450                                 |
  | name                      | inside                               |
  | port_security_enabled     | True                                 |
  | project_id                | 9d390c83cc4e46c7a40167dee68075f0     |
  | provider:network_type     | None                                 |
  | provider:physical_network | None                                 |
  | provider:segmentation_id  | None                                 |
  | qos_policy_id             | None                                 |
  | revision_number           | 2                                    |
  | router:external           | Internal                             |
  | segments                  | None                                 |
  | shared                    | False                                |
  | status                    | ACTIVE                               |
  | subnets                   |                                      |
  | tags                      |                                      |
  | updated_at                | 2018-04-01T09:14:41Z                 |
  +---------------------------+--------------------------------------+
</code></pre>
</div>

<p>Next we will create new subnets. Before that, let us list down the existing subnets for reference.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>stack@openstack-instance-2:~/devstack$ openstack subnet list -f yaml
- ID: 244ed014-8b9f-4e4d-ab12-9931ecec4238
  Name: private-subnet
  Network: 2ebe2084-6dae-40dd-8704-7954944238d7
  Subnet: 10.0.0.0/26
- ID: 265de598-d881-4d58-a185-1a69be39b2fd
  Name: ipv6-private-subnet
  Network: 2ebe2084-6dae-40dd-8704-7954944238d7
  Subnet: fd7b:34b0:9a57::/64
</code></pre>
</div>

<p>Create a new subnet within the network. We will call it <code class="highlighter-rouge">net-01</code> and assign a subnet range of <code class="highlighter-rouge">10.1.1.0/24</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code>  stack@openstack-instance-2:~/devstack$ openstack subnet create net-01 --network inside --subnet-range 10.1.1.0/24
  +-------------------+--------------------------------------+
  | Field             | Value                                |
  +-------------------+--------------------------------------+
  | allocation_pools  | 10.1.1.2-10.1.1.254                  |
  | cidr              | 10.1.1.0/24                          |
  | created_at        | 2018-04-01T09:20:13Z                 |
  | description       |                                      |
  | dns_nameservers   |                                      |
  | enable_dhcp       | True                                 |
  | gateway_ip        | 10.1.1.1                             |
  | host_routes       |                                      |
  | id                | 0317aa4a-84d3-44df-8781-3f04d558a473 |
  | ip_version        | 4                                    |
  | ipv6_address_mode | None                                 |
  | ipv6_ra_mode      | None                                 |
  | name              | net-01                               |
  | network_id        | a0fc23dd-f1a5-4e9b-9d58-ea63b30d076b |
  | project_id        | 9d390c83cc4e46c7a40167dee68075f0     |
  | revision_number   | 0                                    |
  | segment_id        | None                                 |
  | service_types     |                                      |
  | subnetpool_id     | None                                 |
  | tags              |                                      |
  | updated_at        | 2018-04-01T09:20:13Z                 |
  +-------------------+--------------------------------------+
</code></pre>
</div>

<p>As mentioned earlier, the relation between subnet and network is many-to-one. So we can create another subnet <code class="highlighter-rouge">net-02</code> within the same <code class="highlighter-rouge">inside</code> network.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  stack@openstack-instance-2:~/devstack$ openstack subnet create net-02 --network inside --subnet-range 10.1.2.0/24
  +-------------------+--------------------------------------+
  | Field             | Value                                |
  +-------------------+--------------------------------------+
  | allocation_pools  | 10.1.2.2-10.1.2.254                  |
  | cidr              | 10.1.2.0/24                          |
  | created_at        | 2018-04-01T09:21:07Z                 |
  | description       |                                      |
  | dns_nameservers   |                                      |
  | enable_dhcp       | True                                 |
  | gateway_ip        | 10.1.2.1                             |
  | host_routes       |                                      |
  | id                | 6e5f2220-29da-4679-962f-22934f2c3d49 |
  | ip_version        | 4                                    |
  | ipv6_address_mode | None                                 |
  | ipv6_ra_mode      | None                                 |
  | name              | net-02                               |
  | network_id        | a0fc23dd-f1a5-4e9b-9d58-ea63b30d076b |
  | project_id        | 9d390c83cc4e46c7a40167dee68075f0     |
  | revision_number   | 0                                    |
  | segment_id        | None                                 |
  | service_types     |                                      |
  | subnetpool_id     | None                                 |
  | tags              |                                      |
  | updated_at        | 2018-04-01T09:21:07Z                 |
  +-------------------+--------------------------------------+
</code></pre>
</div>

<h2 id="creating-nova-compute-instances">Creating nova compute instances</h2>

<p>We need to know the image names available before creating an instance. List the images available.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  stack@openstack-instance-2:~/devstack$ openstack image list -f yaml
  - ID: 2a5fbb6b-b694-4f76-ac19-4af358d1c7e8
    Name: cirros-0.3.5-x86_64-disk
    Status: active
</code></pre>
</div>

<p>Cirros is a tiny image available as part of devstack, useful for testing purpose. Let us create two instances under inside network running cirros image.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  stack@openstack-instance-2:~/devstack$ openstack server create /
  --flavor m1.tiny --image cirros-0.3.5-x86_64-disk --network inside host --min 2 --max 2
  +-----------------------------+-----------------------------------------------------------------+
  | Field                       | Value                                                           |
  +-----------------------------+-----------------------------------------------------------------+
  | OS-DCF:diskConfig           | MANUAL                                                          |
  | OS-EXT-AZ:availability_zone |                                                                 |
  | OS-EXT-STS:power_state      | NOSTATE                                                         |
  | OS-EXT-STS:task_state       | scheduling                                                      |
  | OS-EXT-STS:vm_state         | building                                                        |
  | OS-SRV-USG:launched_at      | None                                                            |
  | OS-SRV-USG:terminated_at    | None                                                            |
  | accessIPv4                  |                                                                 |
  | accessIPv6                  |                                                                 |
  | addresses                   |                                                                 |
  | adminPass                   | odJy58yPdHnz                                                    |
  | config_drive                |                                                                 |
  | created                     | 2018-04-01T09:25:55Z                                            |
  | flavor                      | m1.tiny (1)                                                     |
  | hostId                      |                                                                 |
  | id                          | dbda4926-4ca6-40be-b673-d0c811ae43c2                            |
  | image                       | cirros-0.3.5-x86_64-disk (2a5fbb6b-b694-4f76-ac19-4af358d1c7e8) |
  | key_name                    | None                                                            |
  | name                        | host-1                                                          |
  | progress                    | 0                                                               |
  | project_id                  | 9d390c83cc4e46c7a40167dee68075f0                                |
  | properties                  |                                                                 |
  | security_groups             | name='default'                                                  |
  | status                      | BUILD                                                           |
  | updated                     | 2018-04-01T09:25:55Z                                            |
  | user_id                     | dfd4e794f59f48549016de1263c30dbb                                |
  | volumes_attached            |                                                                 |
  +-----------------------------+-----------------------------------------------------------------+
</code></pre>
</div>

<blockquote>
  <p>Either min or max parameter is necessary. or else server build fails miserably with no clue as to what went wrong.</p>
</blockquote>

<p>Note that in the above command we specified only the network and not subnet. But this network has two subnets. So let us see which subnet is chosen to run the nova compute instances.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  stack@openstack-instance-2:~/devstack$ openstack server list -f yaml
  - Flavor: m1.tiny
    ID: 5ea3d968-aa29-4911-b658-e0b6498b09f4
    Image: cirros-0.3.5-x86_64-disk
    Name: host-2
    Networks: inside=10.1.1.9
    Status: ACTIVE
  - Flavor: m1.tiny
    ID: dbda4926-4ca6-40be-b673-d0c811ae43c2
    Image: cirros-0.3.5-x86_64-disk
    Name: host-1
    Networks: inside=10.1.1.10
    Status: ACTIVE
</code></pre>
</div>

<p>It turns out the first subnet <code class="highlighter-rouge">net-01</code> we created is being used. But if we want to specify <code class="highlighter-rouge">net-02</code> for instance creation, it is more tricky. We need to create a port in that subnet and attach its nic during instance creation.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  stack@openstack-instance-2:~/devstack$ openstack port create \
  --network a0fc23dd-f1a5-4e9b-9d58-ea63b30d076b --fixed-ip subnet=6e5f2220-29da-4679-962f-22934f2c3d49 if-host-02
  +-----------------------+-------------------------------------------------------------------------+
  | Field                 | Value                                                                   |
  +-----------------------+-------------------------------------------------------------------------+
  | admin_state_up        | UP                                                                      |
  | allowed_address_pairs |                                                                         |
  | binding_host_id       | None                                                                    |
  | binding_profile       | None                                                                    |
  | binding_vif_details   | None                                                                    |
  | binding_vif_type      | None                                                                    |
  | binding_vnic_type     | normal                                                                  |
  | created_at            | 2018-04-01T09:32:31Z                                                    |
  | data_plane_status     | None                                                                    |
  | description           |                                                                         |
  | device_id             |                                                                         |
  | device_owner          |                                                                         |
  | dns_assignment        | None                                                                    |
  | dns_domain            | None                                                                    |
  | dns_name              | None                                                                    |
  | extra_dhcp_opts       |                                                                         |
  | fixed_ips             | ip_address='10.1.2.5', subnet_id='6e5f2220-29da-4679-962f-22934f2c3d49' |
  | id                    | 2b9635bf-8f93-4663-9c6d-f40f0492195c                                    |
  | ip_address            | None                                                                    |
  | mac_address           | fa:16:3e:40:08:73                                                       |
  | name                  | if-host-02                                                              |
  | network_id            | a0fc23dd-f1a5-4e9b-9d58-ea63b30d076b                                    |
  | option_name           | None                                                                    |
  | option_value          | None                                                                    |
  | port_security_enabled | True                                                                    |
  | project_id            | 9d390c83cc4e46c7a40167dee68075f0                                        |
  | qos_policy_id         | None                                                                    |
  | revision_number       | 6                                                                       |
  | security_group_ids    | bd41b78c-974c-4854-b808-dec11575964b                                    |
  | status                | DOWN                                                                    |
  | subnet_id             | None                                                                    |
  | tags                  |                                                                         |
  | trunk_details         | None                                                                    |
  | updated_at            | 2018-04-01T09:32:31Z                                                    |
  +-----------------------+-------------------------------------------------------------------------+
</code></pre>
</div>

<p>Now create an instance in this subnet. Use the port id from above output to specify the nic.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  stack@openstack-instance-2:~/devstack$ openstack server create --flavor m1.tiny \
  --image cirros-0.3.5-x86_64-disk --nic port-id=2b9635bf-8f93-4663-9c6d-f40f0492195c  host-3 --max 1
  +-----------------------------+-----------------------------------------------------------------+
  | Field                       | Value                                                           |
  +-----------------------------+-----------------------------------------------------------------+
  | OS-DCF:diskConfig           | MANUAL                                                          |
  | OS-EXT-AZ:availability_zone |                                                                 |
  | OS-EXT-STS:power_state      | NOSTATE                                                         |
  | OS-EXT-STS:task_state       | scheduling                                                      |
  | OS-EXT-STS:vm_state         | building                                                        |
  | OS-SRV-USG:launched_at      | None                                                            |
  | OS-SRV-USG:terminated_at    | None                                                            |
  | accessIPv4                  |                                                                 |
  | accessIPv6                  |                                                                 |
  | addresses                   |                                                                 |
  | adminPass                   | hnN294KgUTrY                                                    |
  | config_drive                |                                                                 |
  | created                     | 2018-04-01T09:52:23Z                                            |
  | flavor                      | m1.tiny (1)                                                     |
  | hostId                      |                                                                 |
  | id                          | 376c3d59-f74c-4b3b-a4c7-5b9fb9d3eef7                            |
  | image                       | cirros-0.3.5-x86_64-disk (2a5fbb6b-b694-4f76-ac19-4af358d1c7e8) |
  | key_name                    | None                                                            |
  | name                        | host-3                                                          |
  | progress                    | 0                                                               |
  | project_id                  | 9d390c83cc4e46c7a40167dee68075f0                                |
  | properties                  |                                                                 |
  | security_groups             | name='default'                                                  |
  | status                      | BUILD                                                           |
  | updated                     | 2018-04-01T09:52:23Z                                            |
  | user_id                     | dfd4e794f59f48549016de1263c30dbb                                |
  | volumes_attached            |                                                                 |
  +-----------------------------+-----------------------------------------------------------------+
</code></pre>
</div>

<p>Before we move on to next section, tet us check the server instances we have created so far.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  stack@openstack-instance-2:~/devstack$ openstack server list -f yaml
  - Flavor: m1.tiny
    ID: 376c3d59-f74c-4b3b-a4c7-5b9fb9d3eef7
    Image: cirros-0.3.5-x86_64-disk
    Name: host-3
    Networks: inside=10.1.2.5
    Status: ACTIVE
  - Flavor: m1.tiny
    ID: 5ea3d968-aa29-4911-b658-e0b6498b09f4
    Image: cirros-0.3.5-x86_64-disk
    Name: host-2
    Networks: inside=10.1.1.9
    Status: ACTIVE
  - Flavor: m1.tiny
    ID: dbda4926-4ca6-40be-b673-d0c811ae43c2
    Image: cirros-0.3.5-x86_64-disk
    Name: host-1
    Networks: inside=10.1.1.10
    Status: ACTIVE
</code></pre>
</div>

<h2 id="neutron-networking-between-hosts">Neutron networking between hosts</h2>

<p>Let us see the subnet membership of each ports.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  stack@openstack-instance-2:~/devstack$ openstack port list -f yaml --fixed-ip subnet=net-01
  - Fixed IP Addresses: 'ip_address=''10.1.1.2'', subnet_id=''0317aa4a-84d3-44df-8781-3f04d558a473''

      ip_address=''10.1.2.2'', subnet_id=''6e5f2220-29da-4679-962f-22934f2c3d49'''
    ID: 6764de9f-deec-494b-a9b4-0903bfbfefea
    MAC Address: fa:16:3e:8f:47:41
    Name: ''
    Status: ACTIVE
  - Fixed IP Addresses: ip_address='10.1.1.9', subnet_id='0317aa4a-84d3-44df-8781-3f04d558a473'
    ID: ab283b4a-5738-48c9-8a53-343a1e5c795d
    MAC Address: fa:16:3e:9d:b6:7f
    Name: ''
    Status: ACTIVE
  - Fixed IP Addresses: ip_address='10.1.1.10', subnet_id='0317aa4a-84d3-44df-8781-3f04d558a473'
    ID: de7ee5de-e694-4ff3-9763-d7fb86e0038c
    MAC Address: fa:16:3e:7a:ce:84
    Name: ''
    Status: ACTIVE

  stack@openstack-instance-2:~/devstack$ openstack port list -f yaml --fixed-ip subnet=net-02
  - Fixed IP Addresses: ip_address='10.1.2.5', subnet_id='6e5f2220-29da-4679-962f-22934f2c3d49'
    ID: 2b9635bf-8f93-4663-9c6d-f40f0492195c
    MAC Address: fa:16:3e:40:08:73
    Name: if-host-02
    Status: ACTIVE
  - Fixed IP Addresses: 'ip_address=''10.1.1.2'', subnet_id=''0317aa4a-84d3-44df-8781-3f04d558a473''

      ip_address=''10.1.2.2'', subnet_id=''6e5f2220-29da-4679-962f-22934f2c3d49'''
    ID: 6764de9f-deec-494b-a9b4-0903bfbfefea
    MAC Address: fa:16:3e:8f:47:41
    Name: ''
    Status: ACTIVE
</code></pre>
</div>

<p>We can see that one port appears in both the subnets (MAC address: <code class="highlighter-rouge">fa:16:3e:8f:47:41</code>). This is the default DNS server of the network and gets attached to the subnet automatically unless we explicitly specify otherwise.</p>

<p>To test connectivity we need to console in to the hosts. We will use <code class="highlighter-rouge">virsh</code> to console in to the instances. First let us list the hosts.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  stack@openstack-instance-2:~/devstack$ sudo virsh list
   Id    Name                           State
  ----------------------------------------------------
   1     instance-00000001              running
   2     instance-00000002              running
   3     instance-00000003              running
</code></pre>
</div>

<p>Console to the first instance <code class="highlighter-rouge">host-1</code>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  stack@openstack-instance-2:~/devstack$ sudo virsh console 1
  Connected to domain instance-00000001
  Escape character is ^]

  login as 'cirros' user. default password: 'cubswin:)'. use 'sudo' for root.
  cirros login: cirros
  Password: 
  $ ip add | grep 'inet.*10'
      inet 10.1.1.10/24 brd 10.1.1.255 scope global eth0
  $ sudo hostname cirros-1-1-1-10
  $ export PS1="\h$ "
</code></pre>
</div>

<p>We will see that this host can talk to other host <code class="highlighter-rouge">host-2</code> within the same subnet.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>cirros-1-1-1-10$ ping 10.1.1.9
PING 10.1.1.9 (10.1.1.9): 56 data bytes
64 bytes from 10.1.1.9: seq=0 ttl=64 time=4.409 ms
64 bytes from 10.1.1.9: seq=1 ttl=64 time=1.070 ms
64 bytes from 10.1.1.9: seq=2 ttl=64 time=1.437 ms

--- 10.1.1.9 ping statistics ---
3 packets transmitted, 3 packets received, 0% packet loss
round-trip min/avg/max = 1.070/2.305/4.409 ms
</code></pre>
</div>

<p>But it cannot reach host-3 which is a different subnet (<code class="highlighter-rouge">net-02</code>)</p>

<div class="highlighter-rouge"><pre class="highlight"><code>cirros-1-1-1-10$ ping 10.1.2.5
PING 10.1.2.5 (10.1.2.5): 56 data bytes

--- 10.1.2.5 ping statistics ---
3 packets transmitted, 0 packets received, 100% packet loss
</code></pre>
</div>

<p>Likewise, the host cannot reach external network such as internet.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>cirros-1-1-1-10$ ping 8.8.8.8
PING 8.8.8.8 (8.8.8.8): 56 data bytes

--- 8.8.8.8 ping statistics ---
3 packets transmitted, 0 packets received, 100% packet loss
</code></pre>
</div>

<p>Like in any tradional network, we need a router to allow traffic between different subnets. OpenStack Neutron provides a software defined router which can attach to multiple subnets and provide the same functionality.</p>

<p>Let us go ahead and create a router.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>stack@openstack-instance-2:~/devstack$ openstack router create demo_router
+-------------------------+--------------------------------------+
| Field                   | Value                                |
+-------------------------+--------------------------------------+
| admin_state_up          | UP                                   |
| availability_zone_hints |                                      |
| availability_zones      |                                      |
| created_at              | 2018-04-02T00:14:29Z                 |
| description             |                                      |
| distributed             | False                                |
| external_gateway_info   | None                                 |
| flavor_id               | None                                 |
| ha                      | False                                |
| id                      | f36a24b0-e4a3-41de-9fdd-73f85df9dbaa |
| name                    | demo_router                          |
| project_id              | 9d390c83cc4e46c7a40167dee68075f0     |
| revision_number         | 1                                    |
| routes                  |                                      |
| status                  | ACTIVE                               |
| tags                    |                                      |
| updated_at              | 2018-04-02T00:14:29Z                 |
+-------------------------+--------------------------------------+
</code></pre>
</div>

<p>List the routers visible to validate the result. You can see an existing pre-built router and the one we created just now.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  stack@openstack-instance-2:~/devstack$ openstack router list -f yaml
  - Distributed: false
    HA: false
    ID: 58cc905f-4c8b-4641-ba92-a1a491d818ab
    Name: router1
    Project: 9d390c83cc4e46c7a40167dee68075f0
    State: UP
    Status: ACTIVE
  - Distributed: false
    HA: false
    ID: f36a24b0-e4a3-41de-9fdd-73f85df9dbaa
    Name: demo_router
    Project: 9d390c83cc4e46c7a40167dee68075f0
    State: UP
    Status: ACTIVE
</code></pre>
</div>

<p>Now we will attach our subnets to the router.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  stack@openstack-instance-2:~/devstack$ openstack router add subnet demo_router net-01
  stack@openstack-instance-2:~/devstack$ openstack router add subnet demo_router net-02
</code></pre>
</div>

<p>You can see one new port from each subnet getting attached to the router.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  stack@openstack-instance-2:~/devstack$ openstack port list -f yaml --router demo_router
  - Fixed IP Addresses: ip_address='10.1.1.1', subnet_id='0317aa4a-84d3-44df-8781-3f04d558a473'
    ID: 468ff846-fb1d-4ef2-85b0-3957885c59a8
    MAC Address: fa:16:3e:b1:31:fa
    Name: ''
    Status: ACTIVE
  - Fixed IP Addresses: ip_address='10.1.2.1', subnet_id='6e5f2220-29da-4679-962f-22934f2c3d49'
    ID: ee15064b-26f2-46ae-bc09-02db440edd3b
    MAC Address: fa:16:3e:7c:62:28
    Name: ''
    Status: ACTIVE
</code></pre>
</div>
<blockquote>
  <p>To reduce the output I have filtered the port list with an argument –router <router name="">. Most list commands have ability to filter output like this. Use the interactive help menu to figure out the filter options.</router></p>
</blockquote>

<p>Let us try to reach the host on the other network.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  cirros-1-1-1-10$ ping 10.1.2.5
  PING 10.1.2.5 (10.1.2.5): 56 data bytes
  64 bytes from 10.1.2.5: seq=0 ttl=63 time=4.141 ms
  64 bytes from 10.1.2.5: seq=1 ttl=63 time=1.499 ms

  --- 10.1.2.5 ping statistics ---
  2 packets transmitted, 2 packets received, 0% packet loss
  round-trip min/avg/max = 1.499/2.820/4.141 ms
</code></pre>
</div>

<p>Success! As expected, the host is one hop away.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  cirros-1-1-1-10$ traceroute 10.1.2.5
  traceroute to 10.1.2.5 (10.1.2.5), 30 hops max, 46 byte packets
   1  host-10-1-1-1.openstacklocal (10.1.1.1)  2.217 ms  0.360 ms  0.301 ms
   2  host-10-1-2-5.openstacklocal (10.1.2.5)  1.568 ms  1.155 ms  0.803 ms
</code></pre>
</div>

<p>But the outside world connection is not ready yet. For that we need to attach it to a public network. Recall that there was a pre-built public network as part of devstack setup. We will use this network to communicate to outside world.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  stack@openstack-instance-2:~/devstack$ openstack router set --external-gateway public demo_router
  stack@openstack-instance-2:~/devstack$ openstack router show demo_router -f yaml
  admin_state_up: UP
  availability_zone_hints: ''
  availability_zones: nova
  created_at: '2018-04-02T00:14:29Z'
  description: ''
  distributed: false
  external_gateway_info: '{"network_id": "1fe4e71c-d94e-400c-bcee-8067b621c827", "enable_snat":
    true, "external_fixed_ips": [{"subnet_id": "c0718110-7493-46bf-ba48-720762e47934",
    "ip_address": "172.24.4.3"}, {"subnet_id": "fab15575-ae4f-4528-bf0d-ac40d2000484",
    "ip_address": "2001:db8::6"}]}'
  flavor_id: null
  ha: false
  id: f36a24b0-e4a3-41de-9fdd-73f85df9dbaa
  interfaces_info: '[{"subnet_id": "0317aa4a-84d3-44df-8781-3f04d558a473", "ip_address":
    "10.1.1.1", "port_id": "468ff846-fb1d-4ef2-85b0-3957885c59a8"}, {"subnet_id": "6e5f2220-29da-4679-962f-22934f2c3d49",
    "ip_address": "10.1.2.1", "port_id": "ee15064b-26f2-46ae-bc09-02db440edd3b"}]'
  name: demo_router
  project_id: 9d390c83cc4e46c7a40167dee68075f0
  revision_number: 5
  routes: ''
  status: ACTIVE
  tags: ''
  updated_at: '2018-04-02T00:32:54Z'
</code></pre>
</div>
<blockquote>
  <p>The show command is similar to list command, but can show more detailed information about a single resource. As expected, it requires an additional unique identifier argument to identify the resource which we want to display.</p>
</blockquote>

<p>See that there is a new external_gateway_info section. Now let us try to reach the internet.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  stack@openstack-instance-2:~/devstack$ sudo virsh console 1
  Connected to domain instance-00000001
  Escape character is ^]

  cirros-1-1-1-10$ ping 8.8.8.8
  PING 8.8.8.8 (8.8.8.8): 56 data bytes
  64 bytes from 8.8.8.8: seq=0 ttl=50 time=7.129 ms
  64 bytes from 8.8.8.8: seq=1 ttl=51 time=1.483 ms
  64 bytes from 8.8.8.8: seq=2 ttl=51 time=1.137 ms
  
  --- 8.8.8.8 ping statistics ---
  3 packets transmitted, 3 packets received, 0% packet loss
  round-trip min/avg/max = 1.137/3.249/7.129 ms
</code></pre>
</div>

<p>Success! To see how this traffic reaches out to internet, we will do tcpdump on the hypervisor.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  stack@openstack-instance-2:~/ sudo tcpdump 'host 8.8.8.8' -X
  tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
  listening on br-ex, link-type EN10MB (Ethernet), capture size 262144 bytes
  00:37:14.019550 IP 172.24.4.3 &gt; google-public-dns-a.google.com: ICMP echo request, id 49153, seq 0, length 64
    0x0000:  4500 0054 0979 4000 3f01 7205 ac18 0403  E..T.y@.?.r.....
    0x0010:  0808 0808 0800 5076 c001 0000 73cd 73ba  ......Pv....s.s.
    0x0020:  0000 0000 0000 0000 0000 0000 0000 0000  ................
    0x0030:  0000 0000 0000 0000 0000 0000 0000 0000  ................
    0x0040:  0000 0000 0000 0000 0000 0000 0000 0000  ................
    0x0050:  0000 0000                                ....
  00:37:14.020493 IP google-public-dns-a.google.com &gt; 172.24.4.3: ICMP echo reply, id 49153, seq 0, length 64
    0x0000:  4500 0054 0000 0000 3401 c67e 0808 0808  E..T....4..~....
    0x0010:  ac18 0403 0000 5876 c001 0000 73cd 73ba  ......Xv....s.s.
    0x0020:  0000 0000 0000 0000 0000 0000 0000 0000  ................
    0x0030:  0000 0000 0000 0000 0000 0000 0000 0000  ................
    0x0040:  0000 0000 0000 0000 0000 0000 0000 0000  ................
    0x0050:  0000 0000    
</code></pre>
</div>

<p>The traffic from the host is being source NAT by the router to go out to the internet (recall from the earlier output that 172.24.4.3 belongs to the external gateway of the router). In traditional networking term this is called NAT overloading. This can provide only outbound connectivity for the host.</p>

<p>In order to provide inbound connectivity to the host, we need to create a floating ip. This is similar to elastic IP in AWS or staic NAT in traditional networking.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  stack@openstack-instance-2:~/devstack$ openstack floating ip create public
  +---------------------+--------------------------------------+
  | Field               | Value                                |
  +---------------------+--------------------------------------+
  | created_at          | 2018-04-02T00:44:14Z                 |
  | description         |                                      |
  | fixed_ip_address    | None                                 |
  | floating_ip_address | 172.24.4.5                           |
  | floating_network_id | 1fe4e71c-d94e-400c-bcee-8067b621c827 |
  | id                  | e2ff37e4-f8f5-4413-98aa-e0df516c1a3b |
  | name                | 172.24.4.5                           |
  | port_id             | None                                 |
  | project_id          | 9d390c83cc4e46c7a40167dee68075f0     |
  | qos_policy_id       | None                                 |
  | revision_number     | 0                                    |
  | router_id           | None                                 |
  | status              | DOWN                                 |
  | subnet_id           | None                                 |
  | tags                | []                                   |
  | updated_at          | 2018-04-02T00:44:14Z                 |
  +---------------------+--------------------------------------+
</code></pre>
</div>

<p>Attach this to our <code class="highlighter-rouge">host-1</code> instance. You can now see the floating IP also listed in the <code class="highlighter-rouge">openstack server list</code> output.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  stack@openstack-instance-2:~/devstack$ openstack server add floating ip host-1 172.24.4.5
  stack@openstack-instance-2:~/devstack$ openstack server list --name host-1 -f yaml
  - Flavor: m1.tiny
    ID: dbda4926-4ca6-40be-b673-d0c811ae43c2
    Image: cirros-0.3.5-x86_64-disk
    Name: host-1
    Networks: inside=10.1.1.10, 172.24.4.5
    Status: ACTIVE
</code></pre>
</div>

<p>Here you can see the floating ip is mapped to our port-id.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  stack@openstack-instance-2:~/devstack$ openstack floating ip show 172.24.4.5
  +---------------------+--------------------------------------+
  | Field               | Value                                |
  +---------------------+--------------------------------------+
  | created_at          | 2018-04-02T00:44:14Z                 |
  | description         |                                      |
  | fixed_ip_address    | 10.1.1.10                            |
  | floating_ip_address | 172.24.4.5                           |
  | floating_network_id | 1fe4e71c-d94e-400c-bcee-8067b621c827 |
  | id                  | e2ff37e4-f8f5-4413-98aa-e0df516c1a3b |
  | name                | 172.24.4.5                           |
  | port_id             | de7ee5de-e694-4ff3-9763-d7fb86e0038c |
  | project_id          | 9d390c83cc4e46c7a40167dee68075f0     |
  | qos_policy_id       | None                                 |
  | revision_number     | 2                                    |
  | router_id           | f36a24b0-e4a3-41de-9fdd-73f85df9dbaa |
  | status              | ACTIVE                               |
  | subnet_id           | None                                 |
  | tags                | []                                   |
  | updated_at          | 2018-04-02T00:47:14Z                 |
  +---------------------+--------------------------------------+
</code></pre>
</div>

<p>We require one last step to initiate inbound connections to the host. Recall that each ports are assigned with a security group. Since this is an inbound connection, we need to explicitly permit access in security group.</p>

<p>Check the Security Group assigned to our port.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  stack@openstack-instance-2:~/devstack$ openstack port 
    \show de7ee5de-e694-4ff3-9763-d7fb86e0038c -c 'security_group_ids' -f yaml
  security_group_ids: bd41b78c-974c-4854-b808-dec11575964b
</code></pre>
</div>

<p>Let us see the rules which are permitted by this security group.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  stack@openstack-instance-2:~/devstack$ openstack security group show bd41b78c-974c-4854-b808-dec11575964b  -f yaml
  created_at: '2018-04-01T09:01:20Z'
  description: Default security group
  id: bd41b78c-974c-4854-b808-dec11575964b
  name: default
  project_id: 9d390c83cc4e46c7a40167dee68075f0
  revision_number: 6
  rules: 'created_at=''2018-04-01T09:01:20Z'', direction=''ingress'', ethertype=''IPv4'',
    id=''2ab4f8a5-43ed-4f3e-8c43-cc854bc8feb3'', remote_group_id=''bd41b78c-974c-4854-b808-dec11575964b'',
    updated_at=''2018-04-01T09:01:20Z''

    created_at=''2018-04-01T09:01:20Z'', direction=''egress'', ethertype=''IPv6'', id=''5c33d0ac-8ee9-4bd7-951c-dca998931828'',
    updated_at=''2018-04-01T09:01:20Z''

    created_at=''2018-04-01T09:01:20Z'', direction=''ingress'', ethertype=''IPv6'',
    id=''d7c7a642-485b-482e-8d26-a958aaafa19e'', remote_group_id=''bd41b78c-974c-4854-b808-dec11575964b'',
    updated_at=''2018-04-01T09:01:20Z''

    created_at=''2018-04-01T09:01:20Z'', direction=''egress'', ethertype=''IPv4'', id=''f41405df-d0c9-4427-ba11-f0a26b025c3e'',
    updated_at=''2018-04-01T09:01:20Z'''
  tags: []
  updated_at: '2018-04-02T01:56:25Z'
</code></pre>
</div>

<p>Here you can see 4 rules, two each for IPv4 and IPv6. For egress rules, you can see that there is no remote prefix or group id configured. It means all outbound connections are permitted. For ingress traffic, you can see that the remote_group_id references to self. It means that all ports assigned to the same security group can send inbound traffic unhindered.</p>

<p>Let us add more rules to permit ICMP and SSH</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  stack@openstack-instance-2:~/devstack$ openstack security group rule create \
  --protocol icmp --ingress --remote-ip 0.0.0.0/0 default
  +-------------------+--------------------------------------+
  | Field             | Value                                |
  +-------------------+--------------------------------------+
  | created_at        | 2018-04-02T01:54:12Z                 |
  | description       |                                      |
  | direction         | ingress                              |
  | ether_type        | IPv4                                 |
  | id                | df23fec9-b87a-47ef-8f38-67472de46071 |
  | name              | None                                 |
  | port_range_max    | None                                 |
  | port_range_min    | None                                 |
  | project_id        | 9d390c83cc4e46c7a40167dee68075f0     |
  | protocol          | icmp                                 |
  | remote_group_id   | None                                 |
  | remote_ip_prefix  | 0.0.0.0/0                            |
  | revision_number   | 0                                    |
  | security_group_id | bd41b78c-974c-4854-b808-dec11575964b |
  | updated_at        | 2018-04-02T01:54:12Z                 |
  +-------------------+--------------------------------------+

  stack@openstack-instance-2:~/devstack$ openstack security group rule create \
  --protocol tcp --dst-port 22 --ingress --remote-ip 0.0.0.0/0 default
  +-------------------+--------------------------------------+
  | Field             | Value                                |
  +-------------------+--------------------------------------+
  | created_at        | 2018-04-02T01:56:25Z                 |
  | description       |                                      |
  | direction         | ingress                              |
  | ether_type        | IPv4                                 |
  | id                | adee3f3f-a5a0-497f-a12d-644e64c7015e |
  | name              | None                                 |
  | port_range_max    | 22                                   |
  | port_range_min    | 22                                   |
  | project_id        | 9d390c83cc4e46c7a40167dee68075f0     |
  | protocol          | tcp                                  |
  | remote_group_id   | None                                 |
  | remote_ip_prefix  | 0.0.0.0/0                            |
  | revision_number   | 0                                    |
  | security_group_id | bd41b78c-974c-4854-b808-dec11575964b |
  | updated_at        | 2018-04-02T01:56:25Z                 |
  +-------------------+--------------------------------------+
</code></pre>
</div>
<blockquote>
  <p>Note that I am using the security group name <code class="highlighter-rouge">default</code> as argument instead of security group id. As with most other arguments, we can use either name or the id. We can find the name from the output of previous show command.</p>
</blockquote>

<p>Now you can see 2 new rules added to the group</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  stack@openstack-instance-2:~/devstack$ openstack security group rule list -c 'IP Protocol' -c 'IP Range' -c 'Port Range' -f yaml
  - IP Protocol: null
    IP Range: null
    Port Range: ''
  - IP Protocol: null
    IP Range: null
    Port Range: ''
  - IP Protocol: tcp
    IP Range: 0.0.0.0/0
    Port Range: '22:22'
  - IP Protocol: null
    IP Range: null
    Port Range: ''
  - IP Protocol: icmp
    IP Range: 0.0.0.0/0
    Port Range: ''
  - IP Protocol: null
    IP Range: null
    Port Range: ''
</code></pre>
</div>
<blockquote>
  <p>Note that in the previous list command output, there were lot of fields. Here I have used -c argument to select the interesting fields. To select multiple columns, we have to repeat this -c argument.</p>
</blockquote>

<p>Now we can initiate SSH and ICMP connections to this VM host using floating ip address.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  stack@openstack-instance-2:~/devstack$ ping 172.24.4.5
  PING 172.24.4.5 (172.24.4.5) 56(84) bytes of data.
  64 bytes from 172.24.4.5: icmp_seq=1 ttl=63 time=0.628 ms
  64 bytes from 172.24.4.5: icmp_seq=2 ttl=63 time=0.529 ms
  ^C
  --- 172.24.4.5 ping statistics ---
  2 packets transmitted, 2 received, 0% packet loss, time 1003ms
  rtt min/avg/max/mdev = 0.529/0.578/0.628/0.055 ms
  stack@openstack-instance-2:~/devstack$ ssh cirros@172.24.4.5
  cirros@172.24.4.5's password:
  cirros-1-1-1-10$ 
</code></pre>
</div>
<blockquote>
  <p>Recall that the hosts were able to ping each other even before we updated the security group. It is because all the ports were assigned to the default security group and hosts on security group can talk to each other by virtue of an implicit rule.</p>
</blockquote>

<h2 id="conclusion">Conclusion</h2>
<p>I have barely scratched the surface of things possible with Openstack. However, this post should give a good idea about the general command structure and operation procedures in Openstack. For further learning, dig around the <a href="https://docs.openstack.org/neutron/queens/admin/">official documentation</a> (pay attention to openstack version in the docs, there can be major differences between each versions) or setup a lab environment and play around.</p>

<p>On the Neutron front, there are a lot of topics to explore such as ML2 network types, virtual switch types, L3 agents etc., Redhat’s <a href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/9/html-single/networking_guide/">official documentation</a> provides a good introduction to many of these components.</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            
            <a href="/tag/#/openstack" rel="tag"># openstack</a>
          
            
            <a href="/tag/#/software%20defined%20networking" rel="tag"># software defined networking</a>
          
            
            <a href="/tag/#/networking" rel="tag"># networking</a>
          
        </div>
      

      
      
      
      
      

      
      
        <div class="post-nav" id="post-nav-id">
          <div class="post-nav-next post-nav-item">
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/modelling/2017/12/09/2017-12-09-solving-an-ancient-chinese-math-puzzle-with-constraint-programming-using-googles-or-tools/" rel="prev" title="Solving an ancient Chinese math puzzle with Constraint Programming using Google's OR-Tools">
                Solving an ancient Chinese math puzzle with Constraint Programming using Google's OR-Tools <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      
      

      
    </footer>
  </article>

  <div class="post-spread">
    
  </div>
</div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          

  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      
        
        
        




      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/assets/images/confused-monkey.jpg"
               alt="Tamizh" />
          <p class="site-author-name" itemprop="name">Tamizh</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/">
                <span class="site-state-item-count">23</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        
        
        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              
              
              <span class="links-of-author-item">
                <a href="https://www.linkedin.com/in/thamizh/" target="_blank" title="LinkedIn">
                  
                    <i class="fa fa-fw fa-linkedin"></i>
                  
                  LinkedIn
                </a>
              </span>
            
              
              
              <span class="links-of-author-item">
                <a href="https://github.com/thamizh85" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              
              
              <span class="links-of-author-item">
                <a href="https://twitter.com/t4m1zh" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            





            
              <div class="post-toc-content">
    <ol class=nav>
      <li class="nav-item nav-level-2"> <a class="nav-link" href="#introduction"> <span class="nav-number">1</span> <span class="nav-text">Introduction</span> </a> <ol class="nav-child"> <ol class="nav-child"> <ol class="nav-child"> <ol class="nav-child"> </li></ol> </li></ol> </li></ol> </li></ol> </li> <li class="nav-item nav-level-2"> <a class="nav-link" href="#neutron-concepts"> <span class="nav-number">2</span> <span class="nav-text">Neutron Concepts</span> </a> <ol class="nav-child"> <ol class="nav-child"> <ol class="nav-child"> <ol class="nav-child"> </li></ol> </li></ol> </li></ol> </li></ol> </li> <li class="nav-item nav-level-2"> <a class="nav-link" href="#objective"> <span class="nav-number">3</span> <span class="nav-text">Objective</span> </a> <ol class="nav-child"> <ol class="nav-child"> <ol class="nav-child"> <ol class="nav-child"> </li></ol> </li></ol> </li></ol> </li></ol> </li> <li class="nav-item nav-level-2"> <a class="nav-link" href="#preparing-the-environment"> <span class="nav-number">4</span> <span class="nav-text">Preparing the environment</span> </a> <ol class="nav-child"> <ol class="nav-child"> <ol class="nav-child"> <ol class="nav-child"> </li></ol> </li></ol> </li></ol> </li></ol> </li> <li class="nav-item nav-level-2"> <a class="nav-link" href="#building-subnets"> <span class="nav-number">5</span> <span class="nav-text">Building subnets</span> </a> <ol class="nav-child"> <ol class="nav-child"> <ol class="nav-child"> <ol class="nav-child"> </li></ol> </li></ol> </li></ol> </li></ol> </li> <li class="nav-item nav-level-2"> <a class="nav-link" href="#creating-nova-compute-instances"> <span class="nav-number">6</span> <span class="nav-text">Creating nova compute instances</span> </a> <ol class="nav-child"> <ol class="nav-child"> <ol class="nav-child"> <ol class="nav-child"> </li></ol> </li></ol> </li></ol> </li></ol> </li> <li class="nav-item nav-level-2"> <a class="nav-link" href="#neutron-networking-between-hosts"> <span class="nav-number">7</span> <span class="nav-text">Neutron networking between hosts</span> </a> <ol class="nav-child"> <ol class="nav-child"> <ol class="nav-child"> <ol class="nav-child"> </li></ol> </li></ol> </li></ol> </li></ol> </li> <li class="nav-item nav-level-2"> <a class="nav-link" href="#conclusion"> <span class="nav-number">8</span> <span class="nav-text">Conclusion</span> </a> <ol class="nav-child"> <ol class="nav-child"> <ol class="nav-child"> <ol class="nav-child">
    </ol>
  </div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>

        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-hand-spock-o"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tamizh</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://jekyllrb.com">Jekyll</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/simpleyyt/jekyll-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>





















  
   
  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/jquery/index.js?v=2.1.3"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/assets/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/assets/js/src/motion.js?v=5.1.1"></script>



  
  

  <script type="text/javascript" src="/assets/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/assets/js/src/post-details.js?v=5.1.1"></script>


  


  <script type="text/javascript" src="/assets/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  




  

    

  





  






  

  

  
  


  

  

  

</body>
</html>

